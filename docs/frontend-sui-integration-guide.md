# Frontend Sui Blockchain Integration Guide\n\n*Created: January 2025*\n\nThis guide covers the comprehensive Sui blockchain integration implementation for the WalTodo frontend, including TodoNFT operations, error handling patterns, and usage examples.\n\n## Overview\n\nThe frontend Sui integration provides a complete interface for managing TodoNFTs on the Sui blockchain. It includes:\n\n- **Full TodoNFT CRUD Operations**: Create, read, update, delete TodoNFTs\n- **Wallet Integration**: Seamless integration with Suiet wallet kit\n- **Error Handling**: Comprehensive error handling and retry mechanisms\n- **Network Management**: Support for multiple Sui networks (mainnet, testnet, devnet, localnet)\n- **Transaction Tracking**: Real-time transaction status monitoring\n- **Type Safety**: Full TypeScript support with proper type definitions\n\n## Core Files\n\n### 1. `src/lib/sui-client.ts` - Enhanced Sui Client\n\nThe main client for interacting with the Sui blockchain:\n\n```typescript\n// Initialize client\nimport { initializeSuiClient, getSuiClient } from '@/lib/sui-client';\n\n// Initialize with specific network\nconst client = initializeSuiClient('testnet');\n\n// Switch networks\nswitchNetwork('mainnet');\n```\n\n**Key Functions:**\n\n- `getTodosFromBlockchain(ownerAddress?)` - Fetch TodoNFTs owned by address\n- `storeTodoOnBlockchain(params, signAndExecuteTransaction)` - Create new TodoNFT\n- `updateTodoOnBlockchain(params, signAndExecuteTransaction)` - Update existing TodoNFT\n- `completeTodoOnBlockchain(objectId, signAndExecuteTransaction)` - Mark TodoNFT as completed\n- `deleteTodoOnBlockchain(objectId, signAndExecuteTransaction)` - Delete TodoNFT\n- `getTodoByObjectId(objectId)` - Fetch specific TodoNFT\n- `getTodosByObjectIds(objectIds[])` - Batch fetch TodoNFTs\n\n### 2. `src/lib/sui-client-utils.ts` - Utility Functions\n\nEnhanced utilities with error handling and validation:\n\n```typescript\nimport { \n  createTodoSafely,\n  updateTodoSafely,\n  completeTodoSafely,\n  deleteTodoSafely,\n  fetchTodosSafely,\n  retryOperation,\n  validateCreateTodoParams\n} from '@/lib/sui-client-utils';\n\n// Safe operations with automatic retry\nconst result = await createTodoSafely(params, signAndExecuteTransaction, address);\n\n// Retry mechanism for any operation\nconst todos = await retryOperation(\n  () => getTodosFromBlockchain(address),\n  3, // max retries\n  1000 // delay in ms\n);\n```\n\n### 3. `src/hooks/useSuiTodos.ts` - React Hook\n\nReact hook for easy integration with components:\n\n```typescript\nimport { useSuiTodos } from '@/hooks/useSuiTodos';\n\nfunction MyComponent() {\n  const { state, actions, network, isWalletReady } = useSuiTodos();\n  \n  // Access todo state\n  const { todos, loading, error, networkHealth } = state;\n  \n  // Perform operations\n  const { \n    createTodo, \n    updateTodo, \n    completeTodo, \n    deleteTodo, \n    refreshTodos \n  } = actions;\n}\n```\n\n### 4. `src/components/BlockchainTodoManager.tsx` - Example Component\n\nFull-featured TodoNFT management component demonstrating all operations.\n\n## Usage Examples\n\n### Creating a TodoNFT\n\n```typescript\nimport { useSuiTodos } from '@/hooks/useSuiTodos';\nimport { CreateTodoParams } from '@/lib/sui-client';\n\nfunction CreateTodoExample() {\n  const { actions, isWalletReady } = useSuiTodos();\n  \n  const handleCreate = async () => {\n    if (!isWalletReady) {\n      alert('Please connect your wallet');\n      return;\n    }\n    \n    const params: CreateTodoParams = {\n      title: 'My TodoNFT',\n      description: 'This is a blockchain-stored todo',\n      imageUrl: 'https://example.com/todo-image.jpg',\n      metadata: JSON.stringify({ priority: 'high', tags: ['work'] }),\n      isPrivate: false\n    };\n    \n    try {\n      const result = await actions.createTodo(params);\n      \n      if (result.success) {\n        console.log('TodoNFT created:', result.objectId);\n        console.log('Transaction:', result.digest);\n      } else {\n        console.error('Creation failed:', result.error);\n      }\n    } catch (error) {\n      console.error('Unexpected error:', error);\n    }\n  };\n  \n  return (\n    <button onClick={handleCreate}>\n      Create TodoNFT\n    </button>\n  );\n}\n```\n\n### Updating a TodoNFT\n\n```typescript\nconst handleUpdate = async (todo: Todo) => {\n  if (!todo.objectId) return;\n  \n  const params: UpdateTodoParams = {\n    objectId: todo.objectId,\n    title: 'Updated Title',\n    description: 'Updated description',\n    imageUrl: 'https://example.com/new-image.jpg'\n  };\n  \n  try {\n    const result = await actions.updateTodo(params);\n    \n    if (result.success) {\n      console.log('Todo updated successfully');\n    }\n  } catch (error) {\n    console.error('Update failed:', error);\n  }\n};\n```\n\n### Completing a TodoNFT\n\n```typescript\nconst handleComplete = async (objectId: string) => {\n  try {\n    const result = await actions.completeTodo(objectId);\n    \n    if (result.success) {\n      console.log('Todo marked as completed');\n    }\n  } catch (error) {\n    console.error('Complete operation failed:', error);\n  }\n};\n```\n\n### Fetching TodoNFTs\n\n```typescript\nimport { useEffect } from 'react';\n\nfunction TodoList() {\n  const { state, actions, isWalletReady } = useSuiTodos();\n  \n  useEffect(() => {\n    if (isWalletReady) {\n      actions.refreshTodos();\n    }\n  }, [isWalletReady]);\n  \n  if (state.loading) {\n    return <div>Loading todos...</div>;\n  }\n  \n  if (state.error) {\n    return (\n      <div>\n        <p>Error: {state.error}</p>\n        <button onClick={actions.clearError}>Clear Error</button>\n      </div>\n    );\n  }\n  \n  return (\n    <div>\n      {state.todos.map(todo => (\n        <div key={todo.objectId}>\n          <h3>{todo.title}</h3>\n          <p>{todo.description}</p>\n          <p>Status: {todo.completed ? 'Completed' : 'Active'}</p>\n        </div>\n      ))}\n    </div>\n  );\n}\n```\n\n### Network Switching\n\n```typescript\nfunction NetworkSwitcher() {\n  const { network, actions } = useSuiTodos();\n  \n  const handleNetworkSwitch = async (newNetwork: NetworkType) => {\n    try {\n      await actions.switchToNetwork(newNetwork);\n      console.log(`Switched to ${newNetwork}`);\n    } catch (error) {\n      console.error('Network switch failed:', error);\n    }\n  };\n  \n  return (\n    <select value={network} onChange={(e) => handleNetworkSwitch(e.target.value as NetworkType)}>\n      <option value=\"testnet\">Testnet</option>\n      <option value=\"mainnet\">Mainnet</option>\n      <option value=\"devnet\">Devnet</option>\n      <option value=\"localnet\">Local</option>\n    </select>\n  );\n}\n```\n\n## Error Handling Patterns\n\n### 1. Error Categorization\n\nThe system categorizes errors into specific types:\n\n```typescript\nimport { \n  SuiClientError, \n  TransactionError, \n  WalletNotConnectedError,\n  TodoOperationError \n} from '@/lib/sui-client';\n\ntry {\n  await actions.createTodo(params);\n} catch (error) {\n  if (error instanceof WalletNotConnectedError) {\n    // Handle wallet connection issue\n    showWalletConnectModal();\n  } else if (error instanceof TransactionError) {\n    // Handle transaction failure\n    console.log('Transaction failed:', error.digest);\n  } else if (error instanceof TodoOperationError) {\n    // Handle todo operation specific error\n    showErrorMessage(error.message);\n  } else {\n    // Handle unknown error\n    showGenericErrorMessage();\n  }\n}\n```\n\n### 2. Automatic Retry\n\n```typescript\nimport { retryOperation } from '@/lib/sui-client-utils';\n\n// Automatically retry failed operations\nconst result = await retryOperation(\n  () => actions.createTodo(params),\n  3, // max retries\n  1000 // delay between retries\n);\n```\n\n### 3. Transaction Confirmation\n\n```typescript\nimport { waitForTransactionConfirmation } from '@/lib/sui-client-utils';\n\nconst result = await actions.createTodo(params);\n\nif (result.success && result.digest) {\n  try {\n    // Wait for transaction to be confirmed\n    await waitForTransactionConfirmation(result.digest, 30000);\n    console.log('Transaction confirmed');\n  } catch (error) {\n    console.error('Transaction confirmation failed:', error);\n  }\n}\n```\n\n### 4. Network Health Monitoring\n\n```typescript\nimport { checkNetworkHealth } from '@/lib/sui-client-utils';\n\nconst health = await checkNetworkHealth();\n\nif (!health.healthy) {\n  console.warn(`Network issue: ${health.error}`);\n  console.log(`Latency: ${health.latency}ms`);\n}\n```\n\n## Error Recovery Strategies\n\n### 1. Wallet Connection Recovery\n\n```typescript\nfunction handleWalletError(error: WalletNotConnectedError) {\n  // Show user-friendly message\n  setError('Please connect your wallet to continue');\n  \n  // Optionally trigger wallet connection\n  triggerWalletConnection();\n}\n```\n\n### 2. Network Switching Recovery\n\n```typescript\nfunction handleNetworkError() {\n  // Detect current network issues\n  const health = await checkNetworkHealth();\n  \n  if (!health.healthy) {\n    // Suggest network switch\n    showNetworkSwitchDialog();\n  }\n}\n```\n\n### 3. Transaction Failure Recovery\n\n```typescript\nfunction handleTransactionError(error: TransactionError) {\n  // Log transaction details\n  console.error('Transaction failed:', {\n    digest: error.digest,\n    message: error.message\n  });\n  \n  // Offer retry option\n  showRetryDialog(() => {\n    // Retry the operation\n    retryLastOperation();\n  });\n}\n```\n\n## Configuration\n\n### Environment Variables\n\nSet up environment variables for network configuration:\n\n```env\n# Network configuration\nNEXT_PUBLIC_SUI_NETWORK=testnet\nNEXT_PUBLIC_TODO_PACKAGE_ID=0x25a04efc88188231b2f9eb35310a5025c293c4211d2482fd24fe2c8e2dbc9f74\n\n# Walrus storage\nNEXT_PUBLIC_WALRUS_API_URL=https://api.walrus.tech/v1\nNEXT_PUBLIC_DEFAULT_TODO_IMAGE=https://api.walrus.tech/v1/default-todo-image\n```\n\n### Network URLs\n\nConfigure network endpoints in the sui-client:\n\n```typescript\nconst NETWORK_URLS = {\n  mainnet: 'https://fullnode.mainnet.sui.io:443',\n  testnet: 'https://fullnode.testnet.sui.io:443',\n  devnet: 'https://fullnode.devnet.sui.io:443',\n  localnet: 'http://127.0.0.1:9000'\n};\n```\n\n### TodoNFT Contract Configuration\n\n```typescript\nconst TODO_NFT_CONFIG = {\n  PACKAGE_ID: '0x25a04efc88188231b2f9eb35310a5025c293c4211d2482fd24fe2c8e2dbc9f74',\n  MODULE_NAME: 'todo_nft',\n  STRUCT_NAME: 'TodoNFT'\n};\n```\n\n## Testing\n\n### Unit Tests\n\nTest individual functions:\n\n```typescript\nimport { validateCreateTodoParams } from '@/lib/sui-client-utils';\n\ndescribe('Todo Validation', () => {\n  it('should validate todo parameters', () => {\n    const params = {\n      title: 'Test Todo',\n      description: 'Test description',\n      imageUrl: 'https://example.com/image.jpg'\n    };\n    \n    const errors = validateCreateTodoParams(params);\n    expect(errors).toHaveLength(0);\n  });\n});\n```\n\n### Integration Tests\n\nTest wallet integration:\n\n```typescript\nimport { render, screen } from '@testing-library/react';\nimport { AppWalletProvider } from '@/contexts/WalletContext';\nimport BlockchainTodoManager from '@/components/BlockchainTodoManager';\n\ntest('should render todo manager', () => {\n  render(\n    <AppWalletProvider>\n      <BlockchainTodoManager />\n    </AppWalletProvider>\n  );\n  \n  expect(screen.getByText('TodoNFT Manager')).toBeInTheDocument();\n});\n```\n\n## Best Practices\n\n### 1. Always Check Wallet Connection\n\n```typescript\nif (!isWalletReady) {\n  throw new WalletNotConnectedError();\n}\n```\n\n### 2. Validate Parameters\n\n```typescript\nconst errors = validateCreateTodoParams(params);\nif (errors.length > 0) {\n  throw new Error(`Validation failed: ${errors.join(', ')}`);\n}\n```\n\n### 3. Handle All Error Types\n\n```typescript\ncatch (error) {\n  if (error instanceof WalletNotConnectedError) {\n    // Handle wallet errors\n  } else if (error instanceof TransactionError) {\n    // Handle transaction errors  \n  } else {\n    // Handle unexpected errors\n  }\n}\n```\n\n### 4. Provide User Feedback\n\n```typescript\nconst [loading, setLoading] = useState(false);\nconst [error, setError] = useState<string | null>(null);\n\n// Show loading state\nif (loading) return <LoadingSpinner />;\n\n// Show error state\nif (error) return <ErrorMessage message={error} />;\n```\n\n### 5. Use Transaction Tracking\n\n```typescript\nconst result = await trackTransaction(\n  createTodoSafely(params, signAndExecuteTransaction, address),\n  'create_todo'\n);\n```\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Wallet Not Connected**: Ensure wallet is connected before operations\n2. **Network Issues**: Check network health and switch if needed\n3. **Transaction Failures**: Implement retry logic and proper error handling\n4. **Object Not Found**: Verify object IDs and ownership\n5. **Gas Estimation**: Ensure sufficient balance for transactions\n\n### Debug Tools\n\n```typescript\n// Enable debug logging\nconsole.log('Current network:', getCurrentNetwork());\nconsole.log('Wallet ready:', isWalletReady);\nconsole.log('Network health:', await checkNetworkHealth());\n```\n\nThis comprehensive integration provides a robust foundation for managing TodoNFTs on the Sui blockchain with proper error handling, type safety, and user experience considerations.\n