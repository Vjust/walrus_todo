"use strict";exports.id=639,exports.ids=[639],exports.modules={94107:(e,t,n)=>{n.d(t,{q:()=>s});var r=n(87009),a=n(926);function s({children:e,fallback:t=null}){let[n,s]=(0,a.useState)(!1);return n?r.jsx("div",{suppressHydrationWarning:!0,children:e}):r.jsx("div",{suppressHydrationWarning:!0,children:t})}},56055:(e,t,n)=>{n.d(t,{$C:()=>c});var r,a=n(926),s=n(59821),i=n(65054);!function(e){e.TODO_CREATED="todo_created",e.TODO_UPDATED="todo_updated",e.TODO_COMPLETED="todo_completed",e.TODO_TRANSFERRED="todo_transferred",e.TODO_DELETED="todo_deleted"}(r||(r={}));class o{async initialize(e){try{let t=await (0,i.P3)(process.env.NEXT_PUBLIC_NETWORK||"testnet");if(!t)throw Error("Failed to load network configuration");this.suiClient=new s.u({url:t.network.url}),this.packageId=t.deployment.packageId,this.walletAddress=e||null}catch(e){}}addEventListener(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}removeEventListener(e,t){let n=this.handlers.get(e);if(n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}async startListening(){if(!this.isListening&&this.suiClient&&this.packageId){this.isListening=!0;try{await this.subscribeToTodoEvents(),this.walletAddress&&await this.subscribeToWalletEvents(this.walletAddress)}catch(e){this.isListening=!1}}}stopListening(){this.isListening=!1,this.subscriptions.forEach(e=>{try{e()}catch(e){}}),this.subscriptions.clear()}async updateWalletAddress(e){this.walletAddress=e,this.isListening&&(this.stopListening(),await this.startListening())}async subscribeToTodoEvents(){if(this.suiClient&&this.packageId)try{await this.suiClient.subscribeEvent({filter:{MoveModule:{package:this.packageId,module:"todo_nft"}},onMessage:e=>{this.processBlockchainEvent(e)}}),this.subscriptions.set("todo_events",()=>{})}catch(e){}}async subscribeToWalletEvents(e){if(this.suiClient)try{await this.suiClient.subscribeEvent({filter:{Sender:e},onMessage:t=>{this.processWalletEvent(e,t)}}),this.subscriptions.set(`wallet_${e}`,()=>{})}catch(e){}}processBlockchainEvent(e){try{let t;let{parsedJson:n,type:r,timestampMs:a,id:s}=e;if(!r||!r.includes("todo_nft"))return;let i=null;r.includes("TodoNFTCreated")||r.includes("TodoCreated")?(t="todo_created",i=this.parseCreatedEvent(n)):r.includes("TodoNFTCompleted")||r.includes("TodoCompleted")?(t="todo_completed",i=this.parseCompletedEvent(n)):r.includes("TodoNFTUpdated")?(t="todo_updated",i=this.parseUpdatedEvent(n)):r.includes("TodoNFTTransferred")||r.includes("TodoTransferred")?(t="todo_transferred",i=this.parseTransferredEvent(n)):(t="todo_updated",i=n),this.emitEvent({type:t,data:i,timestamp:new Date(a||Date.now()).toISOString(),transactionId:s?.txDigest,objectId:n?.todo_id||n?.object_id})}catch(e){}}processWalletEvent(e,t){this.processBlockchainEvent(t)}parseCreatedEvent(e){return e?{id:e.todo_id||e.object_id,title:e.title,description:e.description,completed:!1,blockchainStored:!0,objectId:e.todo_id||e.object_id,createdAt:new Date().toISOString(),priority:"medium"}:null}parseCompletedEvent(e){return e?{id:e.todo_id||e.object_id,objectId:e.todo_id||e.object_id,completed:!0,completedAt:new Date(parseInt(e.timestamp)||Date.now()).toISOString(),isNFT:!0,nftData:{owner:e.owner,completedAt:parseInt(e.timestamp)||Date.now()}}:null}parseUpdatedEvent(e){return e?{id:e.todo_id||e.object_id,objectId:e.todo_id||e.object_id,title:e.title,description:e.description,updatedAt:new Date(parseInt(e.timestamp)||Date.now()).toISOString(),isNFT:!0,nftData:{owner:e.owner,updatedAt:parseInt(e.timestamp)||Date.now()}}:null}parseTransferredEvent(e){return e?{todo_id:e.todo_id||e.object_id,from:e.from||e.sender,to:e.to||e.recipient,owner:e.to||e.recipient,timestamp:e.timestamp||Date.now().toString()}:null}emitEvent(e){let t=this.handlers.get(e.type);t&&t.forEach(t=>{try{t(e)}catch(e){}});let n=this.handlers.get("*");n&&n.forEach(t=>{try{t(e)}catch(e){}})}async subscribeToEvents(e){e&&await this.updateWalletAddress(e),await this.startListening()}unsubscribeAll(){this.stopListening(),this.handlers.clear()}destroy(){this.unsubscribeAll(),this.suiClient=null,this.packageId=null,this.walletAddress=null}getConnectionState(){return{connected:this.isListening&&null!==this.suiClient,connecting:!1,error:null,lastReconnectAttempt:0,reconnectAttempts:0,subscriptionCount:this.subscriptions.size}}getConnectionStatus(){return this.isListening&&null!==this.suiClient}simulateEvent(e,t){this.emitEvent({type:e,data:t,timestamp:new Date().toISOString()})}constructor(){this.handlers=new Map,this.suiClient=null,this.isListening=!1,this.subscriptions=new Map,this.walletAddress=null,this.packageId=null}}let l=new o;var d=n(43467);function c(e={}){let{autoStart:t=!0,owner:n,enableReconnect:r=!0,filter:o,enableHistorical:c=!1,debounceConfig:u={delay:300,maxWait:1e3},maxReconnectAttempts:p=5}=e,[h,m]=(0,a.useState)({connected:!1,connecting:!1,error:null,lastReconnectAttempt:0,reconnectAttempts:0}),[w,g]=(0,a.useState)(new Map),[T,f]=(0,a.useState)({totalEvents:0,createdCount:0,completedCount:0,updatedCount:0,transferredCount:0,eventsByOwner:new Map,eventsByHour:new Map}),C=(0,a.useRef)(null),v=(0,a.useRef)(null),y=(0,a.useRef)(null),E=(0,a.useRef)(new Map),b=(0,a.useRef)(new Map),_=(0,a.useRef)(new Set),k=(0,d.tN)(),S=k?.address||null,I=o?.owner||n||S,D=(0,a.useCallback)(async()=>{try{if(C.current||(C.current=l),!v.current){let e=await (0,i.P3)(process.env.NEXT_PUBLIC_NETWORK||"testnet");e&&(v.current=new s.u({url:e.network.url}))}await C.current.initialize();let e=C.current.getConnectionState();m(e),c&&I&&await N()}catch(e){m(t=>({...t,error:e,connecting:!1}))}},[c,I,N]),N=(0,a.useCallback)(async()=>{if(v.current&&I)try{let e=await (0,i.P3)(process.env.NEXT_PUBLIC_NETWORK||"testnet");if(!e)return;let t=await v.current.queryEvents({query:{MoveModule:{package:e.deployment.packageId,module:"todo_nft"}},limit:100,order:"descending"});g(e=>{let n=new Map(e);return t.data.forEach(e=>{let t=A(e);t&&F(t)&&(n.set(t.data.todo_id,t),L(t))}),n})}catch(e){console.error("Failed to load historical events:",e)}},[I,A,F,L]),A=(0,a.useCallback)(e=>{try{let t;let{type:n,parsedJson:r,timestampMs:a,id:s}=e;if(n.includes("TodoNFTCreated"))t="TodoNFTCreated";else if(n.includes("TodoNFTCompleted"))t="TodoNFTCompleted";else if(n.includes("TodoNFTUpdated"))t="TodoNFTUpdated";else{if(!n.includes("TodoNFTTransferred"))return null;t="TodoNFTTransferred"}return{type:t,data:{todo_id:r.todo_id,title:r.title||"",owner:r.owner,timestamp:r.timestamp||a?.toString()||Date.now().toString(),...r},transactionDigest:s?.txDigest,packageId:n.split("::")[0],module:n.split("::")[1],eventSeq:e.eventSeq,timestamp:(a||Date.now()).toString()}}catch(e){return null}},[]),F=(0,a.useCallback)(e=>{if(!o)return!0;if(o.owner&&("owner"in e.data?e.data.owner:"to"in e.data?e.data.to:null)!==o.owner||o.eventTypes&&!o.eventTypes.includes(e.type))return!1;let t=new Date(parseInt(e.data.timestamp));return(!o.startTime||!(t<o.startTime))&&(!o.endTime||!(t>o.endTime))&&(!o.todoIds||!!o.todoIds.includes(e.data.todo_id))},[o]),L=(0,a.useCallback)(e=>{f(t=>{let n={...t};switch(n.totalEvents++,e.type){case"TodoNFTCreated":case"created":n.createdCount++;break;case"TodoNFTCompleted":case"completed":n.completedCount++;break;case"TodoNFTUpdated":case"updated":n.updatedCount++;break;case"TodoNFTTransferred":n.transferredCount++}let r="owner"in e.data?e.data.owner:"to"in e.data?e.data.to:"unknown",a=n.eventsByOwner.get(r)||0;n.eventsByOwner.set(r,a+1);let s=new Date(parseInt(e.data.timestamp)),i=`${s.getFullYear()}-${s.getMonth()}-${s.getDate()}-${s.getHours()}`,o=n.eventsByHour.get(i)||0;return n.eventsByHour.set(i,o+1),n.lastEventTime=e.data.timestamp,n})},[]),O=(0,a.useCallback)((e,t)=>{let n=e.data.todo_id,r=E.current.get(n);r&&clearTimeout(r);let a=b.current.get(n)||[];a.push(e),b.current.set(n,a);let s=setTimeout(()=>{let e=b.current.get(n)||[];e.length>0&&(t(e[e.length-1]),b.current.delete(n)),E.current.delete(n)},u.delay);E.current.set(n,s),u.maxWait&&setTimeout(()=>{let e=E.current.get(n);if(e){clearTimeout(e);let r=b.current.get(n)||[];r.length>0&&(t(r[r.length-1]),b.current.delete(n)),E.current.delete(n)}},u.maxWait)},[u]),M=(0,a.useCallback)(async()=>{if(!r||h.reconnectAttempts>=p)return;let e=Math.min(1e3*Math.pow(2,h.reconnectAttempts),3e4);m(e=>({...e,reconnectAttempts:e.reconnectAttempts+1,lastReconnectAttempt:Date.now()})),y.current=setTimeout(async()=>{try{await B(),_.current.size>0&&await R()}catch(e){M()}},e)},[r,h.reconnectAttempts,p,R,B]),R=(0,a.useCallback)(async()=>{if(v.current&&0!==_.current.size)try{let e=await (0,i.P3)(process.env.NEXT_PUBLIC_NETWORK||"testnet");if(!e)return;(await v.current.queryEvents({query:{MoveModule:{package:e.deployment.packageId,module:"todo_nft"}},limit:50,order:"ascending"})).data.forEach(e=>{let t=A(e);t&&_.current.has(t.data.todo_id)&&(C.current?.simulateEvent(t.type,t.data),_.current.delete(t.data.todo_id))})}catch(e){console.error("Failed to replay missed events:",e)}},[A]),B=(0,a.useCallback)(async()=>{if(C.current||await D(),C.current)try{m(e=>({...e,connecting:!0,error:null})),I&&await C.current.updateWalletAddress(I),await C.current.startListening();let e=C.current.getConnectionState();m(t=>({...t,...e,connecting:!1,reconnectAttempts:0}))}catch(e){m(t=>({...t,error:e,connecting:!1})),r&&M()}},[D,I,r,M]),W=(0,a.useCallback)(()=>{if(y.current&&(clearTimeout(y.current),y.current=null),E.current.forEach(e=>clearTimeout(e)),E.current.clear(),b.current.clear(),C.current){C.current.stopListening();let e=C.current.getConnectionState();m(t=>({...t,...e,connecting:!1}))}},[]),j=(0,a.useCallback)(async()=>{W(),await B()},[W,B]),x=(0,a.useCallback)((e,t)=>{if(!C.current)return()=>{};let n=e=>{let n=e.type&&e.data?e:A(e);n&&F(n)&&(g(e=>{let t=new Map(e);return t.set(n.data.todo_id,n),t}),L(n),u.delay>0?O(n,t):t(n))};return C.current.addEventListener(e,n),()=>{C.current?.removeEventListener(e,n)}},[A,F,L,O,u]),P=(0,a.useCallback)(async e=>{if(!v.current)return[];try{let t=await (0,i.P3)(process.env.NEXT_PUBLIC_NETWORK||"testnet");if(!t)return[];let n=await v.current.queryEvents({query:{MoveModule:{package:t.deployment.packageId,module:"todo_nft"}},limit:1e3,order:"descending"}),r=[];return n.data.forEach(t=>{let n=A(t);if(n){let t=e||o;t?(!t||(!t.owner||("owner"in n.data?n.data.owner:"to"in n.data?n.data.to:null)===t.owner)&&(!t.eventTypes||t.eventTypes.includes(n.type)))&&r.push(n):r.push(n)}}),r}catch(e){return console.error("Failed to query historical events:",e),[]}},[A,o]),U=(0,a.useCallback)(e=>{_.current.add(e)},[]),q=(0,a.useCallback)(()=>({...T}),[T]),z=(0,a.useCallback)(()=>{g(new Map),f({totalEvents:0,createdCount:0,completedCount:0,updatedCount:0,transferredCount:0,eventsByOwner:new Map,eventsByHour:new Map}),_.current.clear()},[]);return{connectionState:h,startSubscription:B,stopSubscription:W,restartSubscription:j,addEventListener:x,isConnected:h.connected,isConnecting:h.connecting,error:h.error,queryHistoricalEvents:P,getEventStatistics:q,clearEventData:z,markEventForReplay:U,eventCache:Array.from(w.values()),eventStatistics:T}}},90193:(e,t,n)=>{n.d(t,{n:()=>s});var r=n(926),a=n(11470);function s(e="testnet"){let[t,n]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),[o,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1),h=(0,r.useCallback)(async()=>{if(d&&!s){if(t||(0,a.Yb)()){t||n(!0);return}i(!0),l(null),p(!0);try{if(await (0,a.sP)(e),(0,a.Yb)())d&&n(!0);else throw Error("Client initialization completed but verification failed")}catch(t){let e=t instanceof Error?t.message:"Failed to initialize Sui client";d&&(l(e),console.error("[useSuiClient] Initialization failed:",t))}finally{d&&i(!1)}}},[e,s,t,d]),m=(0,r.useCallback)(async()=>{if(!d)return null;try{if((0,a.Yb)()||(console.warn("[useSuiClient] Client not available, attempting to initialize..."),await h(),(0,a.Yb)()))return await (0,a.tx)();throw Error("Client still not available after initialization")}catch(e){return console.error("[useSuiClient] Failed to get client:",e),l(e instanceof Error?e.message:"Failed to get client"),null}},[h,d]);return{isInitialized:t,isInitializing:s,error:o,initialize:h,getClient:m}}},22287:e=>{e.exports=JSON.parse('{"re":{"U":{"Bm":"0xf99aee9f21493e1590e7e5a9aea6f343a1f381031a04a732724871fc294be799","e1":"todo_nft","JR":"TodoNFT"}}}')}};