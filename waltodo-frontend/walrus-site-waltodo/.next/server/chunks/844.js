exports.id=844,exports.ids=[844],exports.modules={73360:()=>{},94493:(e,t,r)=>{"use strict";r.d(t,{h6:()=>m,u6:()=>w});var a=r(926),o=r(43467),n=r(28413),i=r(11470),s=r(29238),c=r(65054);let l=new Map,d=new Map,u={maxRetries:3,retryDelay:1e3,backoffMultiplier:2};async function f(e,t=u){let r;for(let a=0;a<t.maxRetries;a++)try{return await e()}catch(e){if((r=e instanceof Error?e:Error(String(e))).message.includes("Wallet not connected")||r.message.includes("User rejected"))throw r;if(a<t.maxRetries-1){let e=t.retryDelay*Math.pow(t.backoffMultiplier,a);await new Promise(t=>setTimeout(t,e))}}throw r}function g(e,t){let r;if(!e)return;let a=`${e}_${t?.size||"full"}`,o=d.get(a);if(o)return o;if(e.startsWith("walrus://")){let a=e.replace("walrus://","");if(r=s.$4.getBlobUrl(a),t?.size&&"full"!==t.size){let e=new URL(r);"thumbnail"===t.size?(e.searchParams.set("w","150"),e.searchParams.set("h","150"),e.searchParams.set("q","85")):"preview"===t.size&&(e.searchParams.set("w","300"),e.searchParams.set("h","300"),e.searchParams.set("q","90")),r=e.toString()}}else r=e;return d.set(a,r),r}async function h(e,t){try{if(!e)throw Error("Wallet not connected");return await f(async()=>await (0,i.wi)(async r=>{let a,o;try{let e=await (0,c.qn)();a=e?.deployment?.packageId||(0,i.$6)()}catch(e){console.warn("Failed to load app config, using fallback package ID:",e),a=(0,i.$6)()}try{o=await r.getOwnedObjects({owner:e,filter:{StructType:`${a}::todo_nft::TodoNFT`},options:{showContent:!0,showOwner:!0,showType:!0,showDisplay:!0},cursor:t?.cursor,limit:t?.limit||50})}catch(n){console.warn("Failed to fetch with specific struct type, trying broader search:",n),(o=await r.getOwnedObjects({owner:e,options:{showContent:!0,showOwner:!0,showType:!0,showDisplay:!0},cursor:t?.cursor,limit:t?.limit||100})).data=o.data.filter(e=>{let t=e.data?.type;return t&&(t.includes("::todo_nft::TodoNFT")||t.includes("TodoNFT")||t.includes(a))})}let n=[],s=[];for(let e of o.data)try{let t=function(e){try{if(!e.data)return console.warn("SuiObject has no data field"),null;if(!e.data.content)return console.warn("SuiObject data has no content field"),null;if("moveObject"!==e.data.content.dataType)return console.warn(`SuiObject content dataType is ${e.data.content.dataType}, expected 'moveObject'`),null;let t=e.data.content.fields;if(!t)return console.warn("SuiObject moveObject has no fields"),null;let r=e.data.objectId,a=t.title||t.name||"Untitled Todo",o=t.description||t.desc||"",n=!1;"boolean"==typeof t.completed?n=t.completed:"string"==typeof t.completed?n="true"===t.completed.toLowerCase():"boolean"==typeof t.is_completed&&(n=t.is_completed);let i=!1;"boolean"==typeof t.is_private?i=t.is_private:"boolean"==typeof t.private&&(i=t.private);let s={};try{s=function(e){if(!e)return{};try{let t=JSON.parse(e);return{priority:t.priority||"medium",tags:Array.isArray(t.tags)?t.tags:[],checklist:Array.isArray(t.checklist)?t.checklist:[],notes:t.notes||"",links:Array.isArray(t.links)?t.links:[],attachments:Array.isArray(t.attachments)?t.attachments:[]}}catch{return{}}}(t.metadata)}catch(e){console.warn("Failed to parse metadata:",e)}let{priority:c,tags:d,checklist:u,notes:f,links:h,attachments:m}=s,w=g(t.image_url||t.imageUrl),p=g(t.image_url||t.imageUrl,{size:"thumbnail"}),y=g(t.image_url||t.imageUrl,{size:"preview"}),b=t.image_url||t.imageUrl;b&&"string"==typeof b&&b.startsWith("walrus://")&&b.replace("walrus://","");let E=e=>{if(!e)return new Date().toISOString();if("string"==typeof e&&e.includes("T"))return e;if("number"==typeof e)return new Date(1e3*e).toISOString();if("string"==typeof e){let t=parseInt(e);if(!isNaN(t))return new Date(t>1e12?t:1e3*t).toISOString()}return new Date().toISOString()},T={id:r,objectId:r,title:a,description:o,completed:n,priority:c||"medium",tags:d||[],blockchainStored:!0,imageUrl:w,createdAt:E(t.created_at||t.createdAt),completedAt:n?E(t.completed_at||t.completedAt):void 0,owner:t.owner||"",metadata:t.metadata||"",isPrivate:i};if(r)try{l.set(r,{data:T,timestamp:Date.now(),imageUrl:w,thumbnailUrl:p,previewUrl:y,metadata:{title:t.title||t.name,description:t.description||t.desc,image_url:t.image_url||t.imageUrl,completed:n,created_at:parseInt(String(t.created_at||t.createdAt||Date.now()/1e3)),completed_at:n&&(t.completed_at||t.completedAt)?parseInt(String(t.completed_at||t.completedAt)):void 0,owner:t.owner||"",metadata:t.metadata||"",is_private:i,attributes:[{trait_type:"Priority",value:c||"medium"},{trait_type:"Status",value:n?"Completed":"Pending"},{trait_type:"Private",value:i},...d&&d.length>0?[{trait_type:"Tags",value:d.join(", ")}]:[]]}})}catch(e){console.warn("Failed to cache NFT data:",e)}return T}catch(t){return console.error("Error transforming Sui object to Todo:",{objectId:e.data?.objectId,error:t instanceof Error?t.message:String(t),suiObject:JSON.stringify(e,null,2)}),null}}(e);t?n.push(t):s.push({objectId:e.data?.objectId||"unknown",error:"Transform returned null"})}catch(t){console.warn("Failed to transform object:",{objectId:e.data?.objectId,error:t instanceof Error?t.message:String(t)}),s.push({objectId:e.data?.objectId||"unknown",error:t instanceof Error?t.message:String(t)})}s.length>0&&console.warn(`Failed to transform ${s.length} objects:`,s);let d=n;if(t?.filter){let{completed:e,priority:r,tags:a}=t.filter;void 0!==e&&(d=d.filter(t=>t.completed===e)),r&&(d=d.filter(e=>e.priority===r)),a&&a.length>0&&(d=d.filter(e=>a.some(t=>e.tags?.includes(t))))}return{todos:d,hasNextPage:o.hasNextPage,nextCursor:o.nextCursor||void 0}}))}catch(t){throw console.error("Error fetching todos from blockchain:",{ownerAddress:e,error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),t}}function m(e){let t=(0,o.tN)(),s=t?.connected||!1,c=t?.address||null,u=t?.trackTransaction||null,g=t?.error||null,m=(0,a.useMemo)(()=>t?.clearError||(()=>{}),[t?.clearError]),[w,p]=(0,a.useState)({todos:[],loading:!1,error:null,networkHealth:!0,refreshing:!1,hasNextPage:!1,nextCursor:void 0}),[y,b]=(0,a.useState)(e?.network||"testnet"),[E,T]=(0,a.useState)({}),k=(0,a.useMemo)(()=>!!(s&&c&&!g),[s,c,g]),x=(0,a.useCallback)(e=>{p(t=>({...t,error:e}))},[]),A=(0,a.useCallback)(e=>{p(t=>({...t,loading:e}))},[]),S=(0,a.useCallback)(e=>{p(t=>({...t,refreshing:e}))},[]),v=(0,a.useCallback)(()=>{x(null),m()},[x,m]),I=(0,a.useCallback)(async()=>{try{p(e=>({...e,networkHealth:!0}))}catch(e){p(e=>({...e,networkHealth:!1})),x(`Health check failed: ${e instanceof Error?e.message:"Unknown error"}`)}},[x]),j=(0,a.useCallback)(e=>{if(e)for(let[t]of(l.delete(e),Array.from(d.entries())))t.includes(e)&&d.delete(t);else l.size,d.size,l.clear(),d.clear()},[]),C=(0,a.useCallback)(async e=>{e.filter(e=>e.imageUrl&&e.imageUrl.startsWith("http")).map(e=>e.imageUrl).forEach(e=>{new Image().src=e})},[]),D=(0,a.useCallback)(async()=>{if(!c){try{let e=(0,n.LC)("default");p(t=>({...t,todos:e,hasNextPage:!1,nextCursor:void 0}))}catch(e){console.warn("Failed to load local todos:",e),p(e=>({...e,todos:[],hasNextPage:!1,nextCursor:void 0}))}return}S(!0),x(null);try{j();let{todos:e,hasNextPage:t,nextCursor:r}=await h(c,{filter:E,limit:50}),a=[];try{a=(0,n.LC)("default",c)}catch(e){console.warn("Failed to fetch local todos:",e)}let o=new Map;a.forEach(e=>{o.set(e.id,e)}),e.forEach(e=>{o.set(e.id,e)});let i=Array.from(o.values());i.sort((e,t)=>{let r=new Date(e.createdAt||0).getTime();return new Date(t.createdAt||0).getTime()-r}),p(e=>({...e,todos:i,hasNextPage:t,nextCursor:r,error:null}));try{await C(i)}catch(e){console.warn("Failed to prefetch images:",e)}}catch(t){let e=t instanceof Error?t.message:"Failed to fetch todos";console.error("Error fetching todos:",{address:c,error:e,stack:t instanceof Error?t.stack:void 0}),x(e);try{let e=(0,n.LC)("default",c);p(t=>({...t,todos:e,hasNextPage:!1,nextCursor:void 0,error:t.error}))}catch(e){console.error("Failed to load local todos as fallback:",e),p(e=>({...e,todos:[],hasNextPage:!1,nextCursor:void 0,error:e.error}))}}finally{S(!1)}},[c,E,y,x,S,C,j]),O=(0,a.useCallback)(async()=>{if(c&&w.hasNextPage&&w.nextCursor){A(!0),x(null);try{let{todos:e,hasNextPage:t,nextCursor:r}=await h(c,{cursor:w.nextCursor,filter:E,limit:50});p(a=>({...a,todos:[...a.todos,...e],hasNextPage:t,nextCursor:r})),C(e)}catch(e){x(e instanceof Error?e.message:"Failed to load more todos")}finally{A(!1)}}},[c,w.hasNextPage,w.nextCursor,E,x,A,C]),P=(0,a.useCallback)(async e=>{T(e)},[]),F=(0,a.useCallback)(async e=>{A(!0),x(null);try{b(e),k&&await D()}catch(t){x(`Failed to switch to ${e} network`)}finally{A(!1)}},[k,D,x,A]),_=(0,a.useCallback)(async e=>{A(!0),x(null);try{let r=JSON.stringify({priority:e.priority||"medium",tags:e.tags||[],dueDate:e.dueDate instanceof Date?e.dueDate.toISOString():e.dueDate}),a=(0,n.rk)("default",{title:e.title,description:e.description,completed:!1,priority:e.priority||"medium",tags:e.tags,dueDate:e.dueDate instanceof Date?e.dueDate.toISOString():e.dueDate},c||void 0);if(k&&c&&t?.signAndExecuteTransaction){t?.signAndExecuteTransaction;let o={title:e.title,description:e.description,priority:e.priority,tags:e.tags,dueDate:e.dueDate,imageUrl:e.imageUrl,metadata:r,isPrivate:e.isPrivate},s=(0,i.storeTodoOnBlockchain)(o,t.signAndExecuteTransaction,c),l=u?await u(s,"Create Todo NFT"):await s;if(l.success&&l.objectId)return a.objectId=l.objectId,a.blockchainStored=!0,(0,n.CU)("default",a,c),await D(),{success:!0,digest:l.digest,objectId:l.objectId}}return await D(),{success:!0,digest:a.id}}catch(t){let e=t instanceof Error?t.message:"Failed to create todo";return x(e),{success:!1,error:e}}finally{A(!1)}},[k,c,u,D,x,A,t?.signAndExecuteTransaction]),N={createTodo:_,updateTodo:(0,a.useCallback)(async e=>{if(!k||!c||!t?.signAndExecuteTransaction)throw Error("Wallet not connected");A(!0),x(null);try{let a=w.todos.find(t=>t.objectId===e.objectId);if(!a)throw Error("Todo not found");let o=JSON.stringify({priority:e.priority||a.priority||"medium",tags:e.tags||a.tags||[],dueDate:e.dueDate||a.dueDate}),n={...e,metadata:o},i=await f(async()=>{let{updateTodoOnBlockchain:e}=await Promise.resolve().then(r.bind(r,11470));return await e(n,t.signAndExecuteTransaction,c)});return i.success&&(p(t=>({...t,todos:t.todos.map(t=>t.objectId===e.objectId?{...t,title:e.title||t.title,description:e.description||t.description,priority:e.priority||t.priority,tags:e.tags||t.tags,dueDate:e.dueDate?e.dueDate instanceof Date?e.dueDate.toISOString():e.dueDate:t.dueDate,metadata:o,updatedAt:new Date().toISOString()}:t)})),l.delete(e.objectId)),i}catch(t){let e=t instanceof Error?t.message:"Failed to update todo";return x(e),{success:!1,error:e}}finally{A(!1)}},[k,c,w.todos,x,A,t?.signAndExecuteTransaction]),completeTodo:(0,a.useCallback)(async e=>{A(!0),x(null);try{let a=w.todos.find(t=>t.id===e||t.objectId===e);if(!a)throw Error("Todo not found");if(a.completed=!0,a.completedAt=new Date().toISOString(),(0,n.CU)("default",a,c||void 0),a.blockchainStored&&a.objectId&&k&&c&&t?.signAndExecuteTransaction){t?.signAndExecuteTransaction;let e=f(async()=>{let{completeTodoOnBlockchain:e}=await Promise.resolve().then(r.bind(r,11470));if(!a.objectId)throw Error("Todo objectId is required for blockchain completion");return await e(a.objectId,t.signAndExecuteTransaction,c)});if(!(u?await u(e,"Complete Todo NFT"):await e).success)throw Error("Failed to complete todo on blockchain")}return await D(),{success:!0,digest:a.objectId||a.id}}catch(t){let e=t instanceof Error?t.message:"Failed to complete todo";return x(e),{success:!1,error:e}}finally{A(!1)}},[w.todos,k,c,u,D,x,A,t?.signAndExecuteTransaction]),deleteTodo:(0,a.useCallback)(async e=>{A(!0),x(null);try{let t=w.todos.find(t=>t.id===e||t.objectId===e);if(!t)throw Error("Todo not found");if(t.blockchainStored)throw Error("Blockchain todos cannot be deleted, only transferred to another address");if((0,n.aS)("default",t.id,c||void 0))return await D(),{success:!0,digest:t.id};return{success:!1,error:"Failed to delete todo"}}catch(t){let e=t instanceof Error?t.message:"Failed to delete todo";return x(e),{success:!1,error:e}}finally{A(!1)}},[w.todos,c,D,x,A]),refreshTodos:D,loadMore:O,filterTodos:P,switchToNetwork:F,checkHealth:I,clearError:v,invalidateCache:j};return{...w,...N,state:w,actions:N,network:y,isWalletReady:k,refetch:D}}function w(){let[e,t]=(0,a.useState)(!1),[n,i]=(0,a.useState)(null),[s,c]=(0,a.useState)(null),l=(0,o.tN)(),d=l?.connected||!1,u=l?.address||null,f=(0,a.useCallback)(async e=>{t(!0),i(null),c(null);try{let t=await e();return c(t),t}catch(e){throw i(e instanceof Error?e.message:"Operation failed"),e}finally{t(!1)}},[]),g=(0,a.useCallback)(()=>{i(null),c(null)},[]),h=(0,a.useCallback)(async e=>{if(!d||!u||!l?.signAndExecuteTransaction)throw Error("Wallet not connected");if(!e.title?.trim())throw Error("Title is required");if(e.title.length>100)throw Error("Title must be 100 characters or less");return f(async()=>{let{storeTodoOnBlockchain:t}=await Promise.resolve().then(r.bind(r,11470));return await t(e,l.signAndExecuteTransaction,u)})},[d,u,l?.signAndExecuteTransaction,f]),m=(0,a.useCallback)(async e=>{if(!d||!u||!l?.signAndExecuteTransaction)throw Error("Wallet not connected");return f(async()=>{let{updateTodoOnBlockchain:t}=await Promise.resolve().then(r.bind(r,11470));return await t(e,l.signAndExecuteTransaction,u)})},[d,u,l?.signAndExecuteTransaction,f]),w=(0,a.useCallback)(async e=>{if(!d||!u||!l?.signAndExecuteTransaction)throw Error("Wallet not connected");return f(async()=>{let{completeTodoOnBlockchain:t}=await Promise.resolve().then(r.bind(r,11470));return await t(e,l.signAndExecuteTransaction,u)})},[d,u,l?.signAndExecuteTransaction,f]),p=(0,a.useCallback)(async e=>{if(!d||!u||!l?.signAndExecuteTransaction)throw Error("Wallet not connected");return f(async()=>{let{deleteTodoOnBlockchain:t}=await Promise.resolve().then(r.bind(r,11470));return await t(e,l.signAndExecuteTransaction,u)})},[d,u,l?.signAndExecuteTransaction,f]),y=(0,a.useCallback)(async(e,t)=>{if(!d||!u||!l?.signAndExecuteTransaction)throw Error("Wallet not connected");if(!t||t.length<10||!t.startsWith("0x"))throw Error("Invalid recipient address");return f(async()=>{let{transferTodoNFT:a}=await Promise.resolve().then(r.bind(r,28413)),o=await a("default",e,t,{signAndExecuteTransaction:l.signAndExecuteTransaction,address:u},u);return{success:o,digest:void 0,objectId:o?e:void 0,error:o?void 0:"Transfer failed"}})},[d,u,l?.signAndExecuteTransaction,f]);return{loading:e,error:n,result:s,executeOperation:f,clearState:g,createTodo:h,updateTodo:m,completeTodo:w,deleteTodo:p,transferTodo:y}}}};