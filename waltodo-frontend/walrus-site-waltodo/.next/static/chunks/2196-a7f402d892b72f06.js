"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2196],{62196:function(e,t,r){r.r(t),r.d(t,{OptimizedImage:function(){return u},OptimizedImageGallery:function(){return d},ProgressiveImage:function(){return g},default:function(){return f}});var a=r(29754),i=r(22585),n=r(57391),o=r(18125),l=r(51705);let s={sizes:{thumbnail:{width:150,height:150,quality:.7},small:{width:320,height:320,quality:.8},medium:{width:640,height:640,quality:.85},large:{width:1024,height:1024,quality:.9},full:{width:1920,height:1920,quality:.95}}};async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"medium";try{let r=s.sizes[t],a=new Image;a.crossOrigin="anonymous",await new Promise((t,r)=>{a.onload=t,a.onerror=r,a.src=e});let i=document.createElement("canvas"),n=i.getContext("2d");if(!n)throw Error("Canvas context not available");let o=a.width/a.height,l=r.width,c=r.height;a.width>a.height?c=l/o:l=c*o,a.width<l&&a.height<c&&(l=a.width,c=a.height),i.width=l,i.height=c,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(a,0,0,l,c);let h=0===i.toDataURL("image/webp").indexOf("data:image/webp");return i.toDataURL("image/".concat(h?"webp":"jpeg"),r.quality)}catch(t){return console.error("Failed to optimize Walrus image:",t),e}}async function h(e){try{let t=await c(e,"thumbnail"),r=new Image;await new Promise((e,a)=>{r.onload=e,r.onerror=a,r.src=t});let a=document.createElement("canvas"),i=a.getContext("2d");if(!i)throw Error("Canvas context not available");return a.width=20,a.height=20,i.filter="blur(10px)",i.drawImage(r,0,0,20,20),a.toDataURL("image/jpeg",.3)}catch(e){return"data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 100 100%22%3E%3Cdefs%3E%3ClinearGradient id%3D%22g%22%3E%3Cstop stop-color%3D%22%23e5e7eb%22 offset%3D%220%25%22%2F%3E%3Cstop stop-color%3D%22%23f3f4f6%22 offset%3D%22100%25%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect width%3D%22100%22 height%3D%22100%22 fill%3D%22url(%23g)%22%2F%3E%3C%2Fsvg%3E"}}function u(e){let{src:t,alt:r,className:s="",width:u,height:d,lazy:g=!0,placeholder:f="blur",priority:m="auto",size:w="medium",sizes:p,quality:v=75,onLoad:y,onError:b,fallbackSrc:E="/images/nft-placeholder.png"}=e,C=(0,i.useRef)(null),[x,D]=(0,i.useState)(!1),z=t&&(t.includes("walrus")||t.includes("blob")),I="boolean"==typeof m?m?"high":"auto":m,F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[r,a]=(0,i.useState)({isLoading:!0,hasError:!1,originalUrl:void 0,optimizedUrl:void 0,blurDataUrl:void 0});return(0,i.useEffect)(()=>{if(!e){a({isLoading:!1,hasError:!1,originalUrl:void 0,optimizedUrl:void 0,blurDataUrl:void 0});return}let r=!0,i=new AbortController;return async function(){try{let i=e.startsWith("blob:")||e.includes("aggregator")?e:(0,l.Jn)(e);if(!r)return;if(a(e=>({...e,originalUrl:i})),t.generateBlur)try{let e=await h(i);r&&a(t=>({...t,blurDataUrl:e}))}catch(e){console.warn("Failed to generate blur placeholder:",e)}let n=await c(i,t.size||"medium");r&&a(e=>({...e,isLoading:!1,hasError:!1,originalUrl:i,optimizedUrl:n}))}catch(e){r&&!i.signal.aborted&&(console.error("Failed to optimize Walrus image:",e),a(e=>({...e,isLoading:!1,hasError:!0})))}}(),()=>{r=!1,i.abort()}},[e,t.size,t.generateBlur]),r}(z?t:void 0,{size:w,priority:I,generateBlur:"blur"===f}),L=(0,o.useProgressiveImage)(z?"":t,{priority:I}),S=(0,o.useLazyImage)(g&&!z?t:"",C),U=z?{isLoading:F.isLoading,hasError:F.hasError||x,loadedSrc:F.optimizedUrl,blurDataUrl:F.blurDataUrl}:g?S:L,P=(0,i.useCallback)(()=>{D(!0),null==b||b()},[b]),j=(0,i.useCallback)(()=>{null==y||y()},[y]);return U.hasError?(0,a.jsx)("div",{ref:C,className:"relative overflow-hidden ".concat(s),style:{width:u,height:d},children:(0,a.jsx)(n.default,{src:E,alt:r,fill:!0,className:"w-full h-full object-cover",onError:()=>console.error("Even fallback image failed to load"),unoptimized:!0})}):(0,a.jsxs)("div",{ref:C,className:"relative overflow-hidden ".concat(s),style:{width:u,height:d},children:[U.isLoading&&("shimmer"===f?(0,a.jsx)("div",{className:"animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 w-full h-full"}):"blur"===f&&U.blurDataUrl?(0,a.jsx)(n.default,{src:U.blurDataUrl,alt:"",fill:!0,className:"absolute inset-0 w-full h-full object-cover filter blur-lg scale-110","aria-hidden":"true",unoptimized:!0}):(0,a.jsx)("div",{className:"bg-gray-200 w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})),U.loadedSrc&&(0,a.jsx)(n.default,{src:U.loadedSrc,alt:r,fill:!0,className:"w-full h-full object-cover transition-opacity duration-300 ".concat(U.isLoading?"opacity-0":"opacity-100"),onLoad:j,onError:P,loading:g?"lazy":"eager",priority:"high"===m||!0===m,sizes:p,quality:v,unoptimized:!!z})]})}function d(e){let{images:t,columns:r=3,imageSize:n="medium",gap:o=4,aspectRatio:l="square"}=e;(0,i.useEffect)(()=>{t.slice(0,2*r).map(e=>e.src).forEach((e,t)=>{let a=document.createElement("link");return a.rel="preload",a.as="image",a.href=e,t<r&&(a.fetchPriority="high"),document.head.appendChild(a),()=>{a.parentNode&&a.parentNode.removeChild(a)}})},[t,r]);let s={square:"aspect-square",video:"aspect-video",portrait:"aspect-[3/4]",landscape:"aspect-[4/3]"}[l];return(0,a.jsx)("div",{className:"grid gap-".concat(o),style:{gridTemplateColumns:"repeat(".concat(r,", 1fr)")},children:t.map((e,t)=>(0,a.jsx)("div",{className:"".concat(s," relative overflow-hidden rounded-lg"),children:(0,a.jsx)(u,{src:e.src,alt:e.alt,className:"absolute inset-0 w-full h-full",size:n,priority:e.priority||t<r?"high":"auto",lazy:t>=2*r})},e.id))})}function g(e){let{src:t,alt:r,className:o,thumbnail:l,onLoad:s}=e,[c,h]=(0,i.useState)(!1),[u,d]=(0,i.useState)(l||"");return(0,i.useEffect)(()=>{if(l&&!c){let e=new window.Image;e.src=l,e.onload=()=>d(l)}let e=new window.Image;e.src=t,e.onload=()=>{d(t),h(!0),null==s||s()}},[t,l,c,s]),(0,a.jsxs)("div",{className:"relative ".concat(o),children:[u&&(0,a.jsx)(n.default,{src:u,alt:r,fill:!0,className:"w-full h-full object-cover transition-all duration-500 ".concat(c?"":"filter blur-sm scale-105"),unoptimized:!0}),!u&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"})]})}var f=u},18125:function(e,t,r){r.r(t),r.d(t,{ProgressiveImageLoader:function(){return f},checkWebPSupport:function(){return c},clearImageCaches:function(){return y},convertToWebP:function(){return u},generateBlurPlaceholder:function(){return h},generateSrcSet:function(){return d},getImagePerformanceMetrics:function(){return v},getOptimizedImageProps:function(){return E},isImageCached:function(){return b},preloadImages:function(){return m},useLazyImage:function(){return p},useProgressiveImage:function(){return w}});var a=r(5604),i=r(22585);let n=new a.z({max:100,ttl:864e5,sizeCalculation:e=>e.length,maxSize:52428800}),o=new a.z({max:200,ttl:6048e5}),l=new Map,s=null;async function c(){if(null!==s)return s;try{let e=new Image,t=await new Promise(t=>{e.onload=()=>t(e.width>0&&e.height>0),e.onerror=()=>t(!1),e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="});return s=t,t}catch(e){return s=!1,!1}}async function h(e){let t=o.get(e);if(t)return t;try{let t=new Image;t.crossOrigin="anonymous",await new Promise((r,a)=>{t.onload=r,t.onerror=a,t.src=e});let r=document.createElement("canvas"),a=r.getContext("2d");if(!a)throw Error("Canvas context not available");r.width=.1*t.width,r.height=.1*t.height,a.filter="blur(5px)",a.drawImage(t,0,0,r.width,r.height);let i=r.toDataURL("image/jpeg",.4);return o.set(e,i),i}catch(e){return console.error("Error generating blur placeholder:",e),"data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 1 1%22%3E%3Cdefs%3E%3ClinearGradient id%3D%22g%22%3E%3Cstop stop-color%3D%22%23e0e0e0%22 offset%3D%220%25%22%2F%3E%3Cstop stop-color%3D%22%23f0f0f0%22 offset%3D%22100%25%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect width%3D%221%22 height%3D%221%22 fill%3D%22url(%23g)%22%2F%3E%3C%2Fsvg%3E"}}async function u(e){if(!await c())return e;let t=n.get("webp:".concat(e));if(t)return t;try{let t=new Image;t.crossOrigin="anonymous",await new Promise((r,a)=>{t.onload=r,t.onerror=a,t.src=e});let r=document.createElement("canvas"),a=r.getContext("2d");if(!a)throw Error("Canvas context not available");r.width=t.width,r.height=t.height,a.drawImage(t,0,0);let i=r.toDataURL("image/webp",.85);return n.set("webp:".concat(e),i),i}catch(t){return console.error("Error converting to WebP:",t),e}}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[320,640,960,1280,1920];return e.includes("walrus")||e.includes("blob")?"".concat(e," 1x"):t.map(t=>"".concat(e,"?w=").concat(t," ").concat(t,"w")).join(", ")}let g=null;class f{async initOfflineCache(){if("caches"in window)try{this.offlineCache=await caches.open("walrus-images-v1")}catch(e){console.error("Failed to open offline cache:",e)}}async load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.performanceStart=performance.now();try{let t=await this.checkOfflineCache(this.state.src);if(t){let e=await t.blob(),r=URL.createObjectURL(e);return this.recordPerformance(e.size,e.type,!0),{src:r,srcSet:d(this.state.src)}}let r=h(this.state.src),a=new Image;"high"===e.priority?(a.loading="eager",a.fetchPriority=e.fetchPriority||"high"):(a.loading="lazy",a.fetchPriority=e.fetchPriority||"auto");let i=new Promise((e,t)=>{a.onload=async()=>{this.state.isLoading=!1,this.state.hasError=!1,await this.cacheOffline(this.state.src);let t=this.state.src;if(!this.state.src.includes(".webp")&&await c())try{t=await u(this.state.src)}catch(e){}this.state.loadedSrc=t,this.recordPerformance(0,"unknown",!1),e({src:t,srcSet:d(this.state.src),width:a.naturalWidth,height:a.naturalHeight})},a.onerror=()=>{this.state.isLoading=!1,this.state.hasError=!0,this.retryCount<this.maxRetries?(this.retryCount++,setTimeout(()=>{a.src=this.state.src},1e3*this.retryCount)):t(Error("Failed to load image: ".concat(this.state.src)))},a.src=this.state.src});try{this.state.blurDataUrl=await r}catch(e){}return await i}catch(e){throw console.error("Image loading error:",e),e}}async checkOfflineCache(e){if(!this.offlineCache)return null;try{return await this.offlineCache.match(e)||null}catch(e){return null}}async cacheOffline(e){if(this.offlineCache)try{let t=await fetch(e);t.ok&&await this.offlineCache.put(e,t.clone())}catch(e){console.error("Failed to cache image offline:",e)}}recordPerformance(e,t,r){let a=performance.now()-this.performanceStart;l.set(this.state.src,{loadTime:a,size:e,format:t,cached:r}),a>3e3&&!r&&console.warn("Slow image load: ".concat(this.state.src," took ").concat(a.toFixed(2),"ms"))}getState(){return{...this.state}}constructor(e){this.performanceStart=0,this.retryCount=0,this.maxRetries=3,this.offlineCache=null,this.state={src:e,isLoading:!0,hasError:!1},this.initOfflineCache()}}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.map(async e=>{try{let r=document.createElement("link");r.rel="preload",r.as="image",r.href=e,"high"===t.priority&&(r.fetchPriority="high"),document.head.appendChild(r);let a=new f(e);await a.load(t)}catch(t){console.error("Failed to preload image: ".concat(e),t)}});await Promise.allSettled(r)}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[r,a]=(0,i.useState)({src:e,isLoading:!0,hasError:!1});return(0,i.useEffect)(()=>{if(!e)return;let r=new f(e);r.load(t).then(e=>{a({src:e.src,isLoading:!1,hasError:!1,loadedSrc:e.src,blurDataUrl:r.getState().blurDataUrl})}).catch(()=>{a(e=>({...e,isLoading:!1,hasError:!0}))})},[e,t]),r}function p(e,t){let[r,a]=(0,i.useState)(!1),n=w(r?e:"",{priority:r?"high":"low"});return(0,i.useEffect)(()=>{var e;let r=t.current;if(!r)return;let i=(e=e=>{e.isIntersecting&&a(!0)},g||(g=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(e(t),null==g||g.unobserve(t.target))})},{rootMargin:"50px",threshold:.01})),g);return i.observe(r),()=>{i.unobserve(r)}},[t]),{...n,isInView:r}}function v(){return new Map(l)}function y(){n.clear(),o.clear(),l.clear()}function b(e){return n.has(e)||n.has("webp:".concat(e))}function E(e){let{src:t,alt:r,sizes:a,className:i,priority:n="auto"}=e;return{src:t,alt:r,className:i,sizes:a||"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",srcSet:d(t),loading:"high"===n?"eager":"lazy",decoding:"async",onLoad:e.onLoad,onError:e.onError}}}}]);