"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4065],{70529:function(e,t,r){r.d(t,{U:function(){return n}});var a=r(22585),o=r(6229);function n(){let[e,t]=(0,a.useState)(!1),r=(0,o.tN)();return((0,a.useEffect)(()=>{let e=setTimeout(()=>{t(!0)},50);return()=>clearTimeout(e)},[]),e)?r?{...r,isLoading:!1}:{connected:!1,connecting:!1,account:null,address:null,chainId:null,name:null,network:"testnet",error:null,isLoading:!1,connect:()=>{},disconnect:()=>{},signAndExecuteTransaction:async()=>{throw Error("Wallet not initialized")},clearError:()=>{},openModal:()=>{},closeModal:()=>{},resetSession:()=>{},resetActivityTimer:()=>{},switchNetwork:()=>{},addTransaction:()=>{},trackTransaction:async()=>{throw Error("Wallet not initialized")},sessionExpired:!1,lastActivity:0,transactionHistory:[],currentNetwork:"testnet",isModalOpen:!1}:{connected:!1,connecting:!1,account:null,address:null,chainId:null,name:null,network:"testnet",error:null,isLoading:!0,connect:()=>{},disconnect:()=>{},signAndExecuteTransaction:async()=>{throw Error("Wallet not ready")},clearError:()=>{},openModal:()=>{},closeModal:()=>{},resetSession:()=>{},resetActivityTimer:()=>{},switchNetwork:()=>{},addTransaction:()=>{},trackTransaction:async()=>{throw Error("Wallet not ready")},sessionExpired:!1,lastActivity:0,transactionHistory:[],currentNetwork:"testnet",isModalOpen:!1}}},84065:function(e,t,r){r.d(t,{p:function(){return i}});var a=r(22585),o=r(51705),n=r(19132);class l{async createTodo(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{epochs:l=5,deletable:s=!0,isPrivate:i=!1,createNFT:c=!0,onProgress:d}=a,u="todo_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),g={...e,id:u,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),blockchainStored:!1,isPrivate:i,storageEpochs:l};try{let e;null==d||d("Uploading to Walrus storage...",25);let a=await this.walrusStorage.storeTodo(g,t,{epochs:l,deletable:s,attributes:{type:"todo",title:g.title,priority:g.priority,private:String(i),created:new Date().toISOString()},onProgress:d?e=>d("Uploading...",25+.5*e):void 0});if(g.walrusBlobId=a.blobId,g.storageSize=a.metadata.size,g.blockchainStored=!0,null==d||d("Upload to Walrus complete",75),c&&r){null==d||d("Creating NFT on Sui blockchain...",85);try{let o={title:g.title,description:g.description||"",imageUrl:"walrus://".concat(a.blobId),metadata:JSON.stringify({walrusBlobId:a.blobId,priority:g.priority,tags:g.tags,dueDate:g.dueDate,storageEpochs:l,createdAt:g.createdAt}),isPrivate:i},s="";"getAddress"in t&&"function"==typeof t.getAddress?s=await t.getAddress():"toSuiAddress"in t&&"function"==typeof t.toSuiAddress&&(s=t.toSuiAddress()),(e=await (0,n.storeTodoOnBlockchain)(o,r,s)).success?(g.suiObjectId=e.objectId,null==d||d("NFT creation complete",100)):(console.warn("Failed to create NFT:",e.error),null==d||d("NFT creation failed, but Walrus storage successful",90))}catch(e){console.warn("NFT creation failed:",e),null==d||d("NFT creation failed, but Walrus storage successful",90)}}else null==d||d("Storage complete",100);let o=await this.walrusClient.calculateStorageCost(a.metadata.size,l),u={walrusBlobId:a.blobId,suiObjectId:g.suiObjectId,storageSize:a.metadata.size,storageEpochs:l,storageCost:{total:o.totalCost,storage:o.storageCost,write:o.writeCost},uploadTimestamp:new Date().toISOString(),expiresAt:a.metadata.expiresAt&&("string"==typeof a.metadata.expiresAt||"number"==typeof a.metadata.expiresAt)?new Date(a.metadata.expiresAt).toISOString():void 0};return{todo:g,walrusResult:a,suiResult:e,metadata:u}}catch(e){if(e instanceof o.AQ)throw e;throw new o.AQ("Failed to create todo: ".concat(e instanceof Error?e.message:"Unknown error"),"TODO_CREATE_ERROR",e instanceof Error?e:void 0)}}async retrieveTodo(e){try{let t=await this.walrusStorage.retrieveTodo(e);if(!t||"object"!=typeof t)throw new o.AQ("Invalid todo data retrieved from storage");return{...t,blockchainStored:!0,walrusBlobId:e}}catch(e){if(e instanceof o.AQ)throw e;throw new o.AQ("Failed to retrieve todo: ".concat(e instanceof Error?e.message:"Unknown error"),"TODO_RETRIEVE_ERROR",e instanceof Error?e:void 0)}}async updateTodo(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={...e,updatedAt:new Date().toISOString()};try{let{onProgress:o,...n}=r,l={...n,...o&&{onProgress:e=>o("storing",e)}};return await this.walrusStorage.storeTodo(a,t,{epochs:e.storageEpochs||5,deletable:!0,attributes:{type:"todo-update",title:a.title,priority:a.priority,originalBlobId:e.walrusBlobId||"",updated:new Date().toISOString()},...l})}catch(e){if(e instanceof o.AQ)throw e;throw new o.AQ("Failed to update todo: ".concat(e instanceof Error?e.message:"Unknown error"),"TODO_UPDATE_ERROR",e instanceof Error?e:void 0)}}async deleteTodo(e,t){try{return await this.walrusClient.deleteBlob(e,t)}catch(e){if(e instanceof o.AQ)throw e;throw new o.AQ("Failed to delete todo: ".concat(e instanceof Error?e.message:"Unknown error"),"TODO_DELETE_ERROR",e instanceof Error?e:void 0)}}async getTodoStorageInfo(e){try{let t;if(!await this.walrusClient.blobExists(e))return{exists:!1};let r=await this.walrusClient.getBlobInfo(e);try{let e=r.size||1024,a=await this.walrusClient.calculateStorageCost(e,5);t={total:a.totalCost,storage:a.storageCost,write:a.writeCost}}catch(e){console.warn("Failed to calculate storage cost:",e)}return{exists:!0,blobInfo:r,storageCost:t}}catch(e){return console.error("Error getting todo storage info:",e),{exists:!1}}}async createMultipleTodos(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=[],{onProgress:n}=a;for(let l=0;l<e.length;l++){let s=e[l];null==n||n("Creating todo ".concat(l+1," of ").concat(e.length),l/e.length*100);try{let e=await this.createTodo(s,t,r,{...a,onProgress:void 0});o.push(e)}catch(e){console.error("Failed to create todo ".concat(l+1,":"),e)}}return null==n||n("Batch creation complete",100),o}async estimateStorageCosts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=BigInt(0),a=0,o=[];for(let n of e){let e=await this.walrusStorage.estimateTodoStorageCost(n,t);r+=e.totalCost,a+=e.sizeBytes,o.push({totalCost:e.totalCost,size:e.sizeBytes})}return{totalCost:r,totalSize:a,perTodoCost:o}}async getWalBalance(){return this.walrusClient.getWalBalance()}async getStorageUsage(){return this.walrusClient.getStorageUsage()}constructor(e="testnet"){this.network=e,this.walrusStorage=new o.zg(e),this.walrusClient=this.walrusStorage.getClient()}}new l;var s=r(70529);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{network:t="testnet",autoRefreshBalance:r=!0,autoRefreshUsage:n=!0,refreshInterval:i=3e4}=e,c=(0,s.U)(),d=(null==c?void 0:c.connected)||!1,u=(null==c?void 0:c.address)||null,g=(null==c?void 0:c.error)||null,w=null==c?void 0:c.signAndExecuteTransaction,[p,h]=(0,a.useState)({loading:!1,uploading:!1,downloading:!1,deleting:!1,progress:0,progressMessage:"",error:null,walBalance:null,storageUsage:null}),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{f.current=new l(t)},[t]);let y=(0,a.useCallback)(()=>(f.current||(f.current=new l(t)),f.current),[t]),b=(0,a.useCallback)((e,t)=>{let r;return r=e instanceof o.AQ?e:new o.AQ("".concat(t," failed: ").concat(e instanceof Error?e.message:"Unknown error"),"OPERATION_ERROR",e instanceof Error?e:void 0),h(e=>({...e,error:r,loading:!1})),r},[]),v=(0,a.useCallback)((e,t)=>{h(r=>({...r,progress:Math.min(100,Math.max(0,t)),progressMessage:e}))},[]),E=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!d||!u)return b(Error("Wallet not connected"),"Create Todo"),null;h(e=>({...e,uploading:!0,loading:!0,error:null,progress:0,progressMessage:"Starting upload..."}));try{let r=y();if(!w)throw Error("Wallet signing capability not available");let a=await r.createTodo(e,{signData:async e=>({signature:new Uint8Array(64),publicKey:new Uint8Array(32)}),getAddress:()=>u,toSuiAddress:()=>u},w,{...t,onProgress:v});return h(e=>({...e,uploading:!1,loading:!1,progress:100,progressMessage:"Upload complete"})),a}catch(e){return h(e=>({...e,uploading:!1})),b(e,"Create Todo"),null}},[d,u,w,y,b,v]),C=(0,a.useCallback)(async e=>{h(e=>({...e,downloading:!0,loading:!0,error:null,progressMessage:"Retrieving todo..."}));try{let t=y(),r=await t.retrieveTodo(e);return h(e=>({...e,downloading:!1,loading:!1,progressMessage:"Retrieval complete"})),r}catch(e){return h(e=>({...e,downloading:!1})),b(e,"Retrieve Todo"),null}},[y,b]),S=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!d||!u)return b(Error("Wallet not connected"),"Update Todo"),!1;h(e=>({...e,uploading:!0,loading:!0,error:null,progressMessage:"Updating todo..."}));try{let r=y();return await r.updateTodo(e,{signData:async e=>({signature:new Uint8Array(64),publicKey:new Uint8Array(32)}),getAddress:()=>u,toSuiAddress:()=>u},t),h(e=>({...e,uploading:!1,loading:!1,progressMessage:"Update complete"})),!0}catch(e){return h(e=>({...e,uploading:!1})),b(e,"Update Todo"),!1}},[d,u,y,b]),A=(0,a.useCallback)(async e=>{if(!d||!u)return b(Error("Wallet not connected"),"Delete Todo"),!1;h(e=>({...e,deleting:!0,loading:!0,error:null,progressMessage:"Deleting todo..."}));try{let t=y();return await t.deleteTodo(e,{signData:async e=>({signature:new Uint8Array(64),publicKey:new Uint8Array(32)}),getAddress:()=>u,toSuiAddress:()=>u}),h(e=>({...e,deleting:!1,loading:!1,progressMessage:"Deletion complete"})),!0}catch(e){return h(e=>({...e,deleting:!1})),b(e,"Delete Todo"),!1}},[d,u,y,b]),T=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!d||!u)return b(Error("Wallet not connected"),"Create Multiple Todos"),[];h(e=>({...e,uploading:!0,loading:!0,error:null,progress:0,progressMessage:"Starting batch upload..."}));try{let r=y();if(!w)throw Error("Wallet signing capability not available");let a=await r.createMultipleTodos(e,{signData:async e=>({signature:new Uint8Array(64),publicKey:new Uint8Array(32)}),getAddress:()=>u,toSuiAddress:()=>u},w,{...t,onProgress:v});return h(e=>({...e,uploading:!1,loading:!1,progress:100,progressMessage:"Batch upload complete"})),a}catch(e){return h(e=>({...e,uploading:!1})),b(e,"Create Multiple Todos"),[]}},[d,u,w,y,b,v]),m=(0,a.useCallback)(async e=>{h(e=>({...e,loading:!0,error:null}));try{let t=y(),r=await t.getTodoStorageInfo(e);return h(e=>({...e,loading:!1})),r}catch(e){return b(e,"Get Storage Info"),null}},[y,b]),I=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;h(e=>({...e,loading:!0,error:null}));try{let r=y(),a=await r.estimateStorageCosts(e,t);return h(e=>({...e,loading:!1})),a}catch(e){return b(e,"Estimate Storage Costs"),null}},[y,b]),k=(0,a.useCallback)(async()=>{try{let e=y(),t=await e.getWalBalance();h(e=>({...e,walBalance:t}))}catch(e){console.warn("Failed to refresh WAL balance:",e)}},[y]),U=(0,a.useCallback)(async()=>{try{let e=y(),t=await e.getStorageUsage();h(e=>({...e,storageUsage:t}))}catch(e){console.warn("Failed to refresh storage usage:",e)}},[y]),O=(0,a.useCallback)(async()=>{try{var e,t;let r=y(),a=r.walrusClient||(null===(t=r.walrusStorage)||void 0===t?void 0:null===(e=t.getClient)||void 0===e?void 0:e.call(t));return a&&"function"==typeof a.getWalBalance&&await a.getWalBalance(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Connection test failed"}}},[y]),M=(0,a.useCallback)(async function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var t,r;let a=y(),o=a.walrusClient||(null===(r=a.walrusStorage)||void 0===r?void 0:null===(t=r.getClient)||void 0===t?void 0:t.call(r));if(o&&"function"==typeof o.upload){let t=await o.upload(e,{epochs:1});return{success:!0,blobId:t.blobId}}throw Error("Walrus client not available")}catch(e){return{success:!1,error:e instanceof Error?e.message:"Upload failed"}}},[y]),R=(0,a.useCallback)(async e=>{try{var t,r;let a=y(),o=a.walrusClient||(null===(r=a.walrusStorage)||void 0===r?void 0:null===(t=r.getClient)||void 0===t?void 0:t.call(r));if(o&&"function"==typeof o.download){let t=await o.download(e);return{success:!0,data:t.data}}throw Error("Walrus client not available")}catch(e){return{success:!1,error:e instanceof Error?e.message:"Retrieval failed"}}},[y]),W=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!d||!u)return b(Error("Wallet not connected"),"Upload Image"),null;h(e=>({...e,uploading:!0,loading:!0,error:null,progress:0,progressMessage:"Uploading image..."}));try{var r,a,o,n,l,s;let i=y(),c=i.walrusClient||(null===(a=i.walrusStorage)||void 0===a?void 0:null===(r=a.getClient)||void 0===r?void 0:r.call(a));if(c&&"function"==typeof c.uploadImage){null==t||null===(o=t.onProgress)||void 0===o||o.call(t,20);let r=await c.uploadImage(e,{epochs:t.epochs||5});null==t||null===(n=t.onProgress)||void 0===n||n.call(t,80);let a=(null===(l=c.getBlobUrl)||void 0===l?void 0:l.call(c,r.blobId))||"walrus://".concat(r.blobId);return h(e=>({...e,uploading:!1,loading:!1,progress:100,progressMessage:"Image uploaded successfully"})),null==t||null===(s=t.onProgress)||void 0===s||s.call(t,100),{blobId:r.blobId,url:a}}throw Error("Image upload not supported")}catch(e){return h(e=>({...e,uploading:!1})),b(e,"Upload Image"),null}},[d,u,y,b]),D=(0,a.useCallback)(()=>{h(e=>({...e,error:null}))},[]),B=(0,a.useCallback)(()=>{h({loading:!1,uploading:!1,downloading:!1,deleting:!1,progress:0,progressMessage:"",error:null,walBalance:null,storageUsage:null})},[]);return(0,a.useEffect)(()=>{let e;if(d&&u){if(r||n){let t=async()=>{r&&await k(),n&&await U()};t(),e=setInterval(t,i)}return()=>{e&&clearInterval(e)}}},[d,u,r,n,i,k,U]),(0,a.useEffect)(()=>{g&&h(e=>({...e,error:new o.AQ("Wallet error: ".concat(g),"WALLET_ERROR")}))},[g]),{...p,createTodo:E,retrieveTodo:C,updateTodo:S,deleteTodo:A,createMultipleTodos:T,getTodoStorageInfo:m,estimateStorageCosts:I,testConnection:O,uploadBlob:M,retrieveBlob:R,uploadImage:W,refreshWalBalance:k,refreshStorageUsage:U,clearError:D,reset:B}}}}]);