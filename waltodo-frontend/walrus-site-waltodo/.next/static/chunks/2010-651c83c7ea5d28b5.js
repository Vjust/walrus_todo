"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2010],{22278:function(e,t,n){n.d(t,{q:function(){return a}});var r=n(29754),i=n(22585);function a(e){let{children:t,fallback:n=null}=e,[a,s]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{s(!0)},[]),a)?(0,r.jsx)("div",{suppressHydrationWarning:!0,children:t}):(0,r.jsx)("div",{suppressHydrationWarning:!0,children:n})}},63786:function(e,t,n){n.d(t,{$C:function(){return h}});var r,i,a=n(22585),s=n(21433),o=n(25288),l=n(32608);(r=i||(i={})).TODO_CREATED="todo_created",r.TODO_UPDATED="todo_updated",r.TODO_COMPLETED="todo_completed",r.TODO_TRANSFERRED="todo_transferred",r.TODO_DELETED="todo_deleted";class c{async initialize(e){try{let t=await (0,o.P3)(l.env.NEXT_PUBLIC_NETWORK||"testnet");if(!t)throw Error("Failed to load network configuration");this.suiClient=new s.u({url:t.network.url}),this.packageId=t.deployment.packageId,this.walletAddress=e||null}catch(e){}}addEventListener(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}removeEventListener(e,t){let n=this.handlers.get(e);if(n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}async startListening(){if(!this.isListening&&this.suiClient&&this.packageId){this.isListening=!0;try{await this.subscribeToTodoEvents(),this.walletAddress&&await this.subscribeToWalletEvents(this.walletAddress)}catch(e){this.isListening=!1}}}stopListening(){this.isListening=!1,this.subscriptions.forEach(e=>{try{e()}catch(e){}}),this.subscriptions.clear()}async updateWalletAddress(e){this.walletAddress=e,this.isListening&&(this.stopListening(),await this.startListening())}async subscribeToTodoEvents(){if(this.suiClient&&this.packageId)try{await this.suiClient.subscribeEvent({filter:{MoveModule:{package:this.packageId,module:"todo_nft"}},onMessage:e=>{this.processBlockchainEvent(e)}}),this.subscriptions.set("todo_events",()=>{})}catch(e){}}async subscribeToWalletEvents(e){if(this.suiClient)try{await this.suiClient.subscribeEvent({filter:{Sender:e},onMessage:t=>{this.processWalletEvent(e,t)}}),this.subscriptions.set("wallet_".concat(e),()=>{})}catch(e){}}processBlockchainEvent(e){try{let t;let{parsedJson:n,type:r,timestampMs:i,id:a}=e;if(!r||!r.includes("todo_nft"))return;let s=null;r.includes("TodoNFTCreated")||r.includes("TodoCreated")?(t="todo_created",s=this.parseCreatedEvent(n)):r.includes("TodoNFTCompleted")||r.includes("TodoCompleted")?(t="todo_completed",s=this.parseCompletedEvent(n)):r.includes("TodoNFTUpdated")?(t="todo_updated",s=this.parseUpdatedEvent(n)):r.includes("TodoNFTTransferred")||r.includes("TodoTransferred")?(t="todo_transferred",s=this.parseTransferredEvent(n)):(t="todo_updated",s=n),this.emitEvent({type:t,data:s,timestamp:new Date(i||Date.now()).toISOString(),transactionId:null==a?void 0:a.txDigest,objectId:(null==n?void 0:n.todo_id)||(null==n?void 0:n.object_id)})}catch(e){}}processWalletEvent(e,t){this.processBlockchainEvent(t)}parseCreatedEvent(e){return e?{id:e.todo_id||e.object_id,title:e.title,description:e.description,completed:!1,blockchainStored:!0,objectId:e.todo_id||e.object_id,createdAt:new Date().toISOString(),priority:"medium"}:null}parseCompletedEvent(e){return e?{id:e.todo_id||e.object_id,objectId:e.todo_id||e.object_id,completed:!0,completedAt:new Date(parseInt(e.timestamp)||Date.now()).toISOString(),isNFT:!0,nftData:{owner:e.owner,completedAt:parseInt(e.timestamp)||Date.now()}}:null}parseUpdatedEvent(e){return e?{id:e.todo_id||e.object_id,objectId:e.todo_id||e.object_id,title:e.title,description:e.description,updatedAt:new Date(parseInt(e.timestamp)||Date.now()).toISOString(),isNFT:!0,nftData:{owner:e.owner,updatedAt:parseInt(e.timestamp)||Date.now()}}:null}parseTransferredEvent(e){return e?{todo_id:e.todo_id||e.object_id,from:e.from||e.sender,to:e.to||e.recipient,owner:e.to||e.recipient,timestamp:e.timestamp||Date.now().toString()}:null}emitEvent(e){let t=this.handlers.get(e.type);t&&t.forEach(t=>{try{t(e)}catch(e){}});let n=this.handlers.get("*");n&&n.forEach(t=>{try{t(e)}catch(e){}})}async subscribeToEvents(e){e&&await this.updateWalletAddress(e),await this.startListening()}unsubscribeAll(){this.stopListening(),this.handlers.clear()}destroy(){this.unsubscribeAll(),this.suiClient=null,this.packageId=null,this.walletAddress=null}getConnectionState(){return{connected:this.isListening&&null!==this.suiClient,connecting:!1,error:null,lastReconnectAttempt:0,reconnectAttempts:0,subscriptionCount:this.subscriptions.size}}getConnectionStatus(){return this.isListening&&null!==this.suiClient}simulateEvent(e,t){this.emitEvent({type:e,data:t,timestamp:new Date().toISOString()})}constructor(){this.handlers=new Map,this.suiClient=null,this.isListening=!1,this.subscriptions=new Map,this.walletAddress=null,this.packageId=null}}let d=new c;var u=n(6229),p=n(32608);function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoStart:t=!0,owner:n,enableReconnect:r=!0,filter:i,enableHistorical:l=!1,debounceConfig:c={delay:300,maxWait:1e3},maxReconnectAttempts:h=5}=e,[f,m]=(0,a.useState)({connected:!1,connecting:!1,error:null,lastReconnectAttempt:0,reconnectAttempts:0}),[w,g]=(0,a.useState)(new Map),[v,T]=(0,a.useState)({totalEvents:0,createdCount:0,completedCount:0,updatedCount:0,transferredCount:0,eventsByOwner:new Map,eventsByHour:new Map}),C=(0,a.useRef)(null),E=(0,a.useRef)(null),y=(0,a.useRef)(null),b=(0,a.useRef)(new Map),_=(0,a.useRef)(new Map),k=(0,a.useRef)(new Set),S=(0,u.tN)(),I=(null==S?void 0:S.address)||null,D=(null==i?void 0:i.owner)||n||I,N=(0,a.useCallback)(async()=>{try{if(C.current||(C.current=d),!E.current){let e=await (0,o.P3)(p.env.NEXT_PUBLIC_NETWORK||"testnet");e&&(E.current=new s.u({url:e.network.url}))}await C.current.initialize();let e=C.current.getConnectionState();m(e),l&&D&&await A()}catch(e){m(t=>({...t,error:e,connecting:!1}))}},[l,D,A]),A=(0,a.useCallback)(async()=>{if(E.current&&D)try{let e=await (0,o.P3)(p.env.NEXT_PUBLIC_NETWORK||"testnet");if(!e)return;let t=await E.current.queryEvents({query:{MoveModule:{package:e.deployment.packageId,module:"todo_nft"}},limit:100,order:"descending"});g(e=>{let n=new Map(e);return t.data.forEach(e=>{let t=F(e);t&&L(t)&&(n.set(t.data.todo_id,t),O(t))}),n})}catch(e){console.error("Failed to load historical events:",e)}},[D,F,L,O]),F=(0,a.useCallback)(e=>{try{let t;let{type:n,parsedJson:r,timestampMs:i,id:a}=e;if(n.includes("TodoNFTCreated"))t="TodoNFTCreated";else if(n.includes("TodoNFTCompleted"))t="TodoNFTCompleted";else if(n.includes("TodoNFTUpdated"))t="TodoNFTUpdated";else{if(!n.includes("TodoNFTTransferred"))return null;t="TodoNFTTransferred"}return{type:t,data:{todo_id:r.todo_id,title:r.title||"",owner:r.owner,timestamp:r.timestamp||(null==i?void 0:i.toString())||Date.now().toString(),...r},transactionDigest:null==a?void 0:a.txDigest,packageId:n.split("::")[0],module:n.split("::")[1],eventSeq:e.eventSeq,timestamp:(i||Date.now()).toString()}}catch(e){return null}},[]),L=(0,a.useCallback)(e=>{if(!i)return!0;if(i.owner&&("owner"in e.data?e.data.owner:"to"in e.data?e.data.to:null)!==i.owner||i.eventTypes&&!i.eventTypes.includes(e.type))return!1;let t=new Date(parseInt(e.data.timestamp));return(!i.startTime||!(t<i.startTime))&&(!i.endTime||!(t>i.endTime))&&(!i.todoIds||!!i.todoIds.includes(e.data.todo_id))},[i]),O=(0,a.useCallback)(e=>{T(t=>{let n={...t};switch(n.totalEvents++,e.type){case"TodoNFTCreated":case"created":n.createdCount++;break;case"TodoNFTCompleted":case"completed":n.completedCount++;break;case"TodoNFTUpdated":case"updated":n.updatedCount++;break;case"TodoNFTTransferred":n.transferredCount++}let r="owner"in e.data?e.data.owner:"to"in e.data?e.data.to:"unknown",i=n.eventsByOwner.get(r)||0;n.eventsByOwner.set(r,i+1);let a=new Date(parseInt(e.data.timestamp)),s="".concat(a.getFullYear(),"-").concat(a.getMonth(),"-").concat(a.getDate(),"-").concat(a.getHours()),o=n.eventsByHour.get(s)||0;return n.eventsByHour.set(s,o+1),n.lastEventTime=e.data.timestamp,n})},[]),M=(0,a.useCallback)((e,t)=>{let n=e.data.todo_id,r=b.current.get(n);r&&clearTimeout(r);let i=_.current.get(n)||[];i.push(e),_.current.set(n,i);let a=setTimeout(()=>{let e=_.current.get(n)||[];e.length>0&&(t(e[e.length-1]),_.current.delete(n)),b.current.delete(n)},c.delay);b.current.set(n,a),c.maxWait&&setTimeout(()=>{let e=b.current.get(n);if(e){clearTimeout(e);let r=_.current.get(n)||[];r.length>0&&(t(r[r.length-1]),_.current.delete(n)),b.current.delete(n)}},c.maxWait)},[c]),R=(0,a.useCallback)(async()=>{if(!r||f.reconnectAttempts>=h)return;let e=Math.min(1e3*Math.pow(2,f.reconnectAttempts),3e4);m(e=>({...e,reconnectAttempts:e.reconnectAttempts+1,lastReconnectAttempt:Date.now()})),y.current=setTimeout(async()=>{try{await W(),k.current.size>0&&await B()}catch(e){R()}},e)},[r,f.reconnectAttempts,h,B,W]),B=(0,a.useCallback)(async()=>{if(E.current&&0!==k.current.size)try{let e=await (0,o.P3)(p.env.NEXT_PUBLIC_NETWORK||"testnet");if(!e)return;(await E.current.queryEvents({query:{MoveModule:{package:e.deployment.packageId,module:"todo_nft"}},limit:50,order:"ascending"})).data.forEach(e=>{let t=F(e);if(t&&k.current.has(t.data.todo_id)){var n;null===(n=C.current)||void 0===n||n.simulateEvent(t.type,t.data),k.current.delete(t.data.todo_id)}})}catch(e){console.error("Failed to replay missed events:",e)}},[F]),W=(0,a.useCallback)(async()=>{if(C.current||await N(),C.current)try{m(e=>({...e,connecting:!0,error:null})),D&&await C.current.updateWalletAddress(D),await C.current.startListening();let e=C.current.getConnectionState();m(t=>({...t,...e,connecting:!1,reconnectAttempts:0}))}catch(e){m(t=>({...t,error:e,connecting:!1})),r&&R()}},[N,D,r,R]),z=(0,a.useCallback)(()=>{if(y.current&&(clearTimeout(y.current),y.current=null),b.current.forEach(e=>clearTimeout(e)),b.current.clear(),_.current.clear(),C.current){C.current.stopListening();let e=C.current.getConnectionState();m(t=>({...t,...e,connecting:!1}))}},[]),j=(0,a.useCallback)(async()=>{z(),await W()},[z,W]),P=(0,a.useCallback)((e,t)=>{if(!C.current)return()=>{};let n=e=>{let n=e.type&&e.data?e:F(e);n&&L(n)&&(g(e=>{let t=new Map(e);return t.set(n.data.todo_id,n),t}),O(n),c.delay>0?M(n,t):t(n))};return C.current.addEventListener(e,n),()=>{var t;null===(t=C.current)||void 0===t||t.removeEventListener(e,n)}},[F,L,O,M,c]),U=(0,a.useCallback)(async e=>{if(!E.current)return[];try{let t=await (0,o.P3)(p.env.NEXT_PUBLIC_NETWORK||"testnet");if(!t)return[];let n=await E.current.queryEvents({query:{MoveModule:{package:t.deployment.packageId,module:"todo_nft"}},limit:1e3,order:"descending"}),r=[];return n.data.forEach(t=>{let n=F(t);if(n){let t=e||i;t?(!t||(!t.owner||("owner"in n.data?n.data.owner:"to"in n.data?n.data.to:null)===t.owner)&&(!t.eventTypes||t.eventTypes.includes(n.type)))&&r.push(n):r.push(n)}}),r}catch(e){return console.error("Failed to query historical events:",e),[]}},[F,i]),x=(0,a.useCallback)(e=>{k.current.add(e)},[]),q=(0,a.useCallback)(()=>({...v}),[v]),H=(0,a.useCallback)(()=>{g(new Map),T({totalEvents:0,createdCount:0,completedCount:0,updatedCount:0,transferredCount:0,eventsByOwner:new Map,eventsByHour:new Map}),k.current.clear()},[]);return(0,a.useEffect)(()=>{let e=!0;return t&&D&&e&&W(),()=>{e=!1,z(),C.current&&(C.current=null)}},[t,D,W,z]),(0,a.useEffect)(()=>{f.error&&r&&!f.connecting&&R()},[f.error,f.connecting,r,R]),(0,a.useEffect)(()=>{if(!C.current)return;let e=setInterval(()=>{if(C.current){let e=C.current.getConnectionState();m(t=>({...t,...e,connecting:!1}))}},5e3);return()=>clearInterval(e)},[]),{connectionState:f,startSubscription:W,stopSubscription:z,restartSubscription:j,addEventListener:P,isConnected:f.connected,isConnecting:f.connecting,error:f.error,queryHistoricalEvents:U,getEventStatistics:q,clearEventData:H,markEventForReplay:x,eventCache:Array.from(w.values()),eventStatistics:v}}},59295:function(e,t,n){n.d(t,{n:function(){return a}});var r=n(22585),i=n(19132);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"testnet",[t,n]=(0,r.useState)(!1),[a,s]=(0,r.useState)(!1),[o,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c&&!u&&(0,i.isSuiClientInitialized)()&&(n(!0),p(!0))},[c,u]);let h=(0,r.useCallback)(async()=>{if(c&&!a){if(t||(0,i.isSuiClientInitialized)()){t||n(!0);return}s(!0),l(null),p(!0);try{if(await (0,i.sP)(e),(0,i.isSuiClientInitialized)())c&&n(!0);else throw Error("Client initialization completed but verification failed")}catch(t){let e=t instanceof Error?t.message:"Failed to initialize Sui client";c&&(l(e),console.error("[useSuiClient] Initialization failed:",t))}finally{c&&s(!1)}}},[e,a,t,c]),f=(0,r.useCallback)(async()=>{if(!c)return null;try{if((0,i.isSuiClientInitialized)()||(console.warn("[useSuiClient] Client not available, attempting to initialize..."),await h(),(0,i.isSuiClientInitialized)()))return await (0,i.tx)();throw Error("Client still not available after initialization")}catch(e){return console.error("[useSuiClient] Failed to get client:",e),l(e instanceof Error?e.message:"Failed to get client"),null}},[h,c]);return(0,r.useEffect)(()=>(d(!0),()=>{d(!1)}),[]),(0,r.useEffect)(()=>{if(c&&!u&&!t){let e=setTimeout(()=>{h()},100);return()=>clearTimeout(e)}},[c,u,t,h]),{isInitialized:t,isInitializing:a,error:o,initialize:h,getClient:f}}},53270:function(e){e.exports=JSON.parse('{"re":{"U":{"Bm":"0xf99aee9f21493e1590e7e5a9aea6f343a1f381031a04a732724871fc294be799","e1":"todo_nft","JR":"TodoNFT"}}}')}}]);