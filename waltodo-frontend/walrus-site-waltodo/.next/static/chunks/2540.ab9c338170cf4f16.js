(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2540,2608],{18125:function(t,e,r){"use strict";r.r(e),r.d(e,{ProgressiveImageLoader:function(){return g},checkWebPSupport:function(){return l},clearImageCaches:function(){return v},convertToWebP:function(){return u},generateBlurPlaceholder:function(){return h},generateSrcSet:function(){return f},getImagePerformanceMetrics:function(){return y},getOptimizedImageProps:function(){return b},isImageCached:function(){return E},preloadImages:function(){return m},useLazyImage:function(){return p},useProgressiveImage:function(){return w}});var n=r(5604),a=r(22585);let i=new n.z({max:100,ttl:864e5,sizeCalculation:t=>t.length,maxSize:52428800}),o=new n.z({max:200,ttl:6048e5}),c=new Map,s=null;async function l(){if(null!==s)return s;try{let t=new Image,e=await new Promise(e=>{t.onload=()=>e(t.width>0&&t.height>0),t.onerror=()=>e(!1),t.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="});return s=e,e}catch(t){return s=!1,!1}}async function h(t){let e=o.get(t);if(e)return e;try{let e=new Image;e.crossOrigin="anonymous",await new Promise((r,n)=>{e.onload=r,e.onerror=n,e.src=t});let r=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw Error("Canvas context not available");r.width=.1*e.width,r.height=.1*e.height,n.filter="blur(5px)",n.drawImage(e,0,0,r.width,r.height);let a=r.toDataURL("image/jpeg",.4);return o.set(t,a),a}catch(t){return console.error("Error generating blur placeholder:",t),"data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 1 1%22%3E%3Cdefs%3E%3ClinearGradient id%3D%22g%22%3E%3Cstop stop-color%3D%22%23e0e0e0%22 offset%3D%220%25%22%2F%3E%3Cstop stop-color%3D%22%23f0f0f0%22 offset%3D%22100%25%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect width%3D%221%22 height%3D%221%22 fill%3D%22url(%23g)%22%2F%3E%3C%2Fsvg%3E"}}async function u(t){if(!await l())return t;let e=i.get("webp:".concat(t));if(e)return e;try{let e=new Image;e.crossOrigin="anonymous",await new Promise((r,n)=>{e.onload=r,e.onerror=n,e.src=t});let r=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw Error("Canvas context not available");r.width=e.width,r.height=e.height,n.drawImage(e,0,0);let a=r.toDataURL("image/webp",.85);return i.set("webp:".concat(t),a),a}catch(e){return console.error("Error converting to WebP:",e),t}}function f(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[320,640,960,1280,1920];return t.includes("walrus")||t.includes("blob")?"".concat(t," 1x"):e.map(e=>"".concat(t,"?w=").concat(e," ").concat(e,"w")).join(", ")}let d=null;class g{async initOfflineCache(){if("caches"in window)try{this.offlineCache=await caches.open("walrus-images-v1")}catch(t){console.error("Failed to open offline cache:",t)}}async load(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.performanceStart=performance.now();try{let e=await this.checkOfflineCache(this.state.src);if(e){let t=await e.blob(),r=URL.createObjectURL(t);return this.recordPerformance(t.size,t.type,!0),{src:r,srcSet:f(this.state.src)}}let r=h(this.state.src),n=new Image;"high"===t.priority?(n.loading="eager",n.fetchPriority=t.fetchPriority||"high"):(n.loading="lazy",n.fetchPriority=t.fetchPriority||"auto");let a=new Promise((t,e)=>{n.onload=async()=>{this.state.isLoading=!1,this.state.hasError=!1,await this.cacheOffline(this.state.src);let e=this.state.src;if(!this.state.src.includes(".webp")&&await l())try{e=await u(this.state.src)}catch(t){}this.state.loadedSrc=e,this.recordPerformance(0,"unknown",!1),t({src:e,srcSet:f(this.state.src),width:n.naturalWidth,height:n.naturalHeight})},n.onerror=()=>{this.state.isLoading=!1,this.state.hasError=!0,this.retryCount<this.maxRetries?(this.retryCount++,setTimeout(()=>{n.src=this.state.src},1e3*this.retryCount)):e(Error("Failed to load image: ".concat(this.state.src)))},n.src=this.state.src});try{this.state.blurDataUrl=await r}catch(t){}return await a}catch(t){throw console.error("Image loading error:",t),t}}async checkOfflineCache(t){if(!this.offlineCache)return null;try{return await this.offlineCache.match(t)||null}catch(t){return null}}async cacheOffline(t){if(this.offlineCache)try{let e=await fetch(t);e.ok&&await this.offlineCache.put(t,e.clone())}catch(t){console.error("Failed to cache image offline:",t)}}recordPerformance(t,e,r){let n=performance.now()-this.performanceStart;c.set(this.state.src,{loadTime:n,size:t,format:e,cached:r}),n>3e3&&!r&&console.warn("Slow image load: ".concat(this.state.src," took ").concat(n.toFixed(2),"ms"))}getState(){return{...this.state}}constructor(t){this.performanceStart=0,this.retryCount=0,this.maxRetries=3,this.offlineCache=null,this.state={src:t,isLoading:!0,hasError:!1},this.initOfflineCache()}}async function m(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.map(async t=>{try{let r=document.createElement("link");r.rel="preload",r.as="image",r.href=t,"high"===e.priority&&(r.fetchPriority="high"),document.head.appendChild(r);let n=new g(t);await n.load(e)}catch(e){console.error("Failed to preload image: ".concat(t),e)}});await Promise.allSettled(r)}function w(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[r,n]=(0,a.useState)({src:t,isLoading:!0,hasError:!1});return(0,a.useEffect)(()=>{if(!t)return;let r=new g(t);r.load(e).then(t=>{n({src:t.src,isLoading:!1,hasError:!1,loadedSrc:t.src,blurDataUrl:r.getState().blurDataUrl})}).catch(()=>{n(t=>({...t,isLoading:!1,hasError:!0}))})},[t,e]),r}function p(t,e){let[r,n]=(0,a.useState)(!1),i=w(r?t:"",{priority:r?"high":"low"});return(0,a.useEffect)(()=>{var t;let r=e.current;if(!r)return;let a=(t=t=>{t.isIntersecting&&n(!0)},d||(d=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(t(e),null==d||d.unobserve(e.target))})},{rootMargin:"50px",threshold:.01})),d);return a.observe(r),()=>{a.unobserve(r)}},[e]),{...i,isInView:r}}function y(){return new Map(c)}function v(){i.clear(),o.clear(),c.clear()}function E(t){return i.has(t)||i.has("webp:".concat(t))}function b(t){let{src:e,alt:r,sizes:n,className:a,priority:i="auto"}=t;return{src:e,alt:r,className:a,sizes:n||"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",srcSet:f(e),loading:"high"===i?"eager":"lazy",decoding:"async",onLoad:t.onLoad,onError:t.onError}}},32608:function(t){var e,r,n,a=t.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function c(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var s=[],l=!1,h=-1;function u(){l&&n&&(l=!1,n.length?s=n.concat(s):h=-1,s.length&&f())}function f(){if(!l){var t=c(u);l=!0;for(var e=s.length;e;){for(n=s,s=[];++h<e;)n&&n[h].run();h=-1,e=s.length}n=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];s.push(new d(t,e)),1!==s.length||l||c(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}}]);