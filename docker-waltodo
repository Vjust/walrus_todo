#!/bin/bash

# WalTodo CLI - Docker-optimized script
# Assumes the project is already built and ready

# Get the absolute path of the installation directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="${SCRIPT_DIR}"

# Environment variables for the CLI
export NODE_OPTIONS="--no-warnings"
export WALTODO_SUPPRESS_WARNINGS="true"
export NODE_ENV="production"

# Check if the required files exist
if [ ! -f "$PROJECT_DIR/package.json" ]; then
  echo "Error: Could not locate package.json in $PROJECT_DIR"
  exit 1
fi

# Try to run using the built CLI first
if [ -f "$PROJECT_DIR/dist/src/index.js" ]; then
  node "$PROJECT_DIR/dist/src/index.js" "$@"
elif [ -f "$PROJECT_DIR/dist/index.js" ]; then
  node "$PROJECT_DIR/dist/index.js" "$@"
else
  echo "Error: Could not find built CLI files"
  echo "Available files in dist:"
  ls -la "$PROJECT_DIR/dist/" 2>/dev/null || echo "No dist directory found"
  exit 1
fi